function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=Array(t);i<t;i++)n[i]=e[i];return n}function t(e,t,i,n,r,o,a){try{var s=e[o](a),c=s.value}catch(e){return void i(e)}s.done?t(c):Promise.resolve(c).then(n,r)}function i(e){return function(){var i=this,n=arguments;return new Promise((function(r,o){var a=e.apply(i,n);function s(e){t(a,r,o,s,c,"next",e)}function c(e){t(a,r,o,s,c,"throw",e)}s(void 0)}))}}function n(e,t,i){return t=l(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,h()?Reflect.construct(t,i||[],l(e).constructor):t.apply(e,i))}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}function a(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=_(e))||t){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function c(e,t,i){return(t=y(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}function h(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(h=function(){return!!e})()}function d(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?d(Object(i),!0).forEach((function(t){c(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function f(){f=function(){return t};var e,t={},i=Object.prototype,n=i.hasOwnProperty,r=Object.defineProperty||function(e,t,i){e[t]=i.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,i){return e[t]=i}}function u(e,t,i,n){var o=t&&t.prototype instanceof y?t:y,a=Object.create(o.prototype),s=new T(n||[]);return r(a,"_invoke",{value:L(e,i,s)}),a}function h(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var d="suspendedStart",p="suspendedYield",g="executing",m="completed",v={};function y(){}function b(){}function _(){}var k={};l(k,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(A([])));w&&w!==i&&n.call(w,a)&&(k=w);var C=_.prototype=y.prototype=Object.create(k);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function i(r,o,a,s){var c=h(e[r],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function L(t,i,n){var r=d;return function(o,a){if(r===g)throw Error("Generator is already running");if(r===m){if("throw"===o)throw a;return{value:e,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var c=I(s,n);if(c){if(c===v)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=g;var l=h(t,i,n);if("normal"===l.type){if(r=n.done?m:p,l.arg===v)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=m,n.method="throw",n.arg=l.arg)}}}function I(t,i){var n=i.method,r=t.iterator[n];if(r===e)return i.delegate=null,"throw"===n&&t.iterator.return&&(i.method="return",i.arg=e,I(t,i),"throw"===i.method)||"return"!==n&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var o=h(r,t.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,v;var a=o.arg;return a?a.done?(i[t.resultName]=a.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,v):a:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,v)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function A(t){if(t||""===t){var i=t[a];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function i(){for(;++r<t.length;)if(n.call(t,r))return i.value=t[r],i.done=!1,i;return i.value=e,i.done=!0,i};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return b.prototype=_,r(C,"constructor",{value:_,configurable:!0}),r(_,"constructor",{value:b,configurable:!0}),b.displayName=l(_,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,c,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},E(S.prototype),l(S.prototype,s,(function(){return this})),t.AsyncIterator=S,t.async=function(e,i,n,r,o){void 0===o&&(o=Promise);var a=new S(u(e,i,n,r),o);return t.isGeneratorFunction(i)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(C),l(C,c,"Generator"),l(C,a,(function(){return this})),l(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=A,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function r(n,r){return s.type="throw",s.arg=t,i.next=n,r&&(i.method="next",i.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),P(i),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;P(i)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,i,n){return this.delegate={iterator:A(t),resultName:i,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,r,o,a,s=[],c=!0,l=!1;try{if(o=(i=i.call(e)).next,0===t);else for(;!(c=(n=o.call(i)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){l=!0,r=e}finally{try{if(!c&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(e,t)||_(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||_(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function _(t,i){if(t){if("string"==typeof t)return e(t,i);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,i):void 0}}function k(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===i&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}k(":root{--ip-bg:#fff;--ip-text:#0d0c22;--ip-text-light:#121127;--ip-text-extra-light:#444;--ip-close:#333;--ip-close-hover:#000;--ip-overlay:rgba(0,0,0,.5);--ip-shadow:0 10px 30px rgba(0,0,0,.1);--ip-border:#dee2e6;--ip-input-focus:hsla(240,5%,64%,.7);--ip-input-box-shadow:0px 4px 4px 0px rgba(6,3,24,.03);--ip-input-disabled:#f5f5f5;--ip-button-bg:#000;--ip-button-border:#c0e5ac;--ip-button-text:#fff;--ip-button-hover:#565564;--ip-button-close-bg:#eef0f1;--ip-button-close-text:#0d0c22;--ip-button-close-hover:#eef0f1;--ip-button-close-border:#eef0f1;--ip-button-disabled:#f5f5f5;--ip-button-text-disabled:silver;--ip-result-bg:#fff;--ip-result-shadow:0 2px 10px rgba(0,0,0,.05);--ip-result-shadow-hover:0 5px 15px rgba(0,0,0,.1);--ip-result-header-color:#55686b;--ip-result-preferred-name-color:#666;--ip-result-details-color:#555;--ip-result-item-hover-bg:#f1f7f8;--ip-result-icon-color:#000;--ip-table-thead-bg:#f5f5f5;--ip-table-thead-color:#55686b;--ip-area-bg:#fff;--ip-table-separator-bg:#f6f6f6;--ip-table-td-hover-bg:#fcfcfc;--ip-tag-bg-default:#fff;--ip-tag-text-default:#0d0c22;--ip-tag-border-default:#e6e5e5;--ip-tag-bg-success:#f6fffb;--ip-tag-text-success:#00874a;--ip-tag-border-success:#c0efda;--ip-tag-bg-warning:#fff3cd;--ip-tag-text-warning:#664d03;--ip-tag-border-warning:#ffe69c;--ip-tag-bg-error:#fffbfc;--ip-tag-text-error:#e93870;--ip-tag-border-error:#fbc9ce;--ip-tag-bg-blue:#e7f5ff;--ip-tag-text-blue:#007bff;--ip-tag-border-blue:#cfe2f3;--ip-tag-bg-purple:#f5f0ff;--ip-tag-text-purple:#6f42c1;--ip-tag-border-purple:#e2d9f3;--ip-tag-bg-green:#f0fff4;--ip-tag-text-green:#28a745;--ip-tag-border-green:#c8e6c9;--ip-tag-bg-yellow:#fff9db;--ip-tag-text-yellow:#ff7c07;--ip-tag-border-yellow:#ffeeba;--ip-tag-text-sauge:#6a6e6d;--ip-tag-bg-sauge:#d4d8d6;--ip-tag-border-sauge:#dddfdc}");k(".ip-body{overflow:hidden}.ip-modal{align-items:center;background-color:rgba(0,0,0,.5);display:none;inset:0;justify-content:center;position:fixed;transition:background-color .3s ease;z-index:1000}.ip-modal-content{background-color:var(--ip-bg);border-radius:30px;box-shadow:0 10px 30px rgba(0,0,0,.1);color:var(--ip-text);display:flex;flex-direction:column;max-height:90vh;max-width:600px;opacity:0;overflow-y:auto;padding:0;position:relative;transform:scale(.9);transition:all .3s cubic-bezier(.68,-.55,.27,1.55),width .3s ease;width:90%}.ip-modal-content.wide-view{max-width:900px}.with-side-container>.ip-header>.ip-header-container{margin:24px 0 0}.ip-back,.ip-close{transition:transform .2s ease}.with-side-container>.ip-header>.ip-header-container .ip-close{margin-right:30px}.with-side-container>.ip-header>.ip-header-container .ip-back{margin-left:30px}.ip-modal-content.with-side-container{max-width:1280px}.ip-container-header-btns{min-width:400px;text-align:end}.ip-modal-open .ip-modal-content{opacity:1;transform:scale(1)}.ip-header{background-color:var(--ip-bg);flex-shrink:0;position:sticky;top:0;z-index:10}.ip-header .ip-header-container{align-items:center;border-bottom:1px solid var(--ip-border);display:flex;justify-content:space-between;margin:24px 40px 0;padding-bottom:24px}.ip-back{color:#333;cursor:pointer;font-size:24px;transition:transform .2s ease}.ip-back:hover{transform:translateX(-3px)}.ip-modal h2{color:var(--ip-text);font-size:20px;font-weight:800;margin:0}.ip-main-container{display:flex;flex-grow:1;overflow:hidden}.ip-scrollable-content{flex-grow:1;min-width:0;overflow-y:auto;scrollbar-color:hsla(0,0%,61%,.5) transparent;scrollbar-width:thin}.ip-scrollable-content::-webkit-scrollbar{width:8px}.ip-scrollable-content::-webkit-scrollbar-thumb{background-color:hsla(0,0%,61%,.5)}.ip-scrollable-content::-webkit-scrollbar-track{background-color:transparent}.ip-content-area{min-height:100%;padding:24px 40px}.ip-side-container{border-left:1px solid var(--ip-border);overflow-y:hidden;position:relative;transition:transform .3s ease;width:400px}.ip-side-container,.ip-side-container .ip-header{background-color:var(--ip-table-separator-bg)}.ip-side-container.overlay{border-left:none;border-top:1px solid var(--ip-border);bottom:0;box-shadow:-5px 0 15px rgba(0,0,0,.1);left:0;position:absolute;top:0;width:100%;z-index:10}.ip-side-container.overlay.open{transform:translateX(0)}.ip-side-close{background:none;border:none;cursor:pointer;font-size:20px;position:absolute;right:10px;top:10px}.ip-results-container,.ip-search-container{min-height:100%;position:relative;transition:opacity .3s ease,transform .3s ease;width:100%}.ip-results-container{min-height:100px}.ip-container-header{align-items:center;background:var(--ip-bg);border-bottom:1px solid var(--ip-border);display:flex;justify-content:space-between;padding-bottom:20px;padding-top:10px;position:sticky;top:0}.ip-truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ip-container-header h3{color:var(--ip-text);font-size:18px!important;font-weight:800!important;margin:0}.ip-container-header p{font-size:12px;letter-spacing:.1rem;margin:0}.ip-result-details p{font-size:12px;font-weight:400;margin:0;text-transform:uppercase}.ip-details-container h4{font-size:18px!important;font-weight:600!important;margin:0}.ip-container-buttons{background:var(--ip-bg);border-top:1px solid var(--ip-border);bottom:0;display:flex;gap:10px;padding-bottom:20px;padding-top:20px;position:sticky}.ip-container-buttons button{width:100%}.ip-footer{background-color:var(--ip-bg);border-top:1px solid var(--ip-border);flex-shrink:0;padding:15px;text-align:center}.ip-create-identity-container,.ip-details-container{min-height:100%}@media (max-width:1200px){.ip-modal-content{flex-direction:column}.ip-modal-content.with-side-container .ip-scrollable-content{width:100%}}");k(".ip-search-option{display:flex;gap:15px;justify-content:center;margin-bottom:15px}.ip-search-option label{align-items:center;border:1px solid var(--ip-border);border-radius:8px;cursor:pointer;display:flex;padding:10px 15px;transition:all .3s ease;width:250px}.ip-search-option label:hover{border-color:var(--ip-input-focus)}.ip-search-option input[type=radio]{align-self:center;margin-bottom:0;margin-right:10px;margin-top:0}.ip-search-option span{align-items:center;display:flex;height:100%}.ip-search-option input[type=radio]:checked+span{font-weight:700;line-height:15px}.ip-search-option input[type=radio]:checked{background-color:var(--ip-bg);border-color:var(--ip-input-focus);box-shadow:var(--ip-input-box-shadow)}.ip-search-option label:has(input[type=radio]:checked){border-color:var(--ip-input-focus);box-shadow:var(--ip-input-box-shadow)}.ip-modal .choices__inner,.ip-modal input[type=date],.ip-modal input[type=email],.ip-modal input[type=text],.ip-modal select{background-color:var(--ip-bg);border:1px solid var(--ip-border);border-radius:4px;color:var(--ip-text);padding:12px;transition:color .2s cubic-bezier(.34,1.56,.64,1),box-shadow,border,background-color,-webkit-box-shadow;transition:all .3s ease;width:100%}.ip-modal input[type=date]:disabled,.ip-modal input[type=email]:disabled,.ip-modal input[type=text]:disabled,.ip-modal select:disabled{background-color:var(--ip-input-disabled)}.ip-modal input:focus,.ip-modal select:focus{border-color:var(--ip-input-focus);box-shadow:var(--ip-input-box-shadow);outline:none!important}.ip-modal .choices__inner:hover,.ip-modal input:hover,.ip-modal select:hover{border-color:var(--ip-input-focus)}@keyframes slideDownWithShadow{0%{box-shadow:0 0 0 transparent;opacity:0;transform:translateY(-20px)}to{box-shadow:0 4px 12px rgba(0,0,0,.15);opacity:1;transform:translateY(0)}}.choices[data-type*=select-one] .choices__list--dropdown{border-radius:8px;box-shadow:0 0 0 transparent;display:none;margin-top:5px;overflow:hidden;transform-origin:top center}.choices[data-type*=select-one] .choices__list--dropdown.is-active{animation:slideDownWithShadow .4s cubic-bezier(.68,-.55,.265,1.55) forwards;display:block}.choices__list--dropdown .choices__item,.choices__list[aria-expanded] .choices__item{font-size:12px;padding:10px;position:relative}.choices[data-type*=select-one] .choices__list--dropdown .choices__input{box-shadow:none}.ip-fieldset{border:1px solid var(--ip-border);border-radius:8px;margin-bottom:20px;padding:20px}.ip-fieldset legend{font-size:18px;font-weight:700;margin-bottom:10px}.ip-form-row{display:flex;flex-wrap:wrap;gap:20px;margin-bottom:20px}.ip-form-input,.ip-form-select{flex:1 1 calc(50% - 10px);min-width:200px}.ip-form-input label,.ip-form-select label{display:block;font-weight:500;margin-bottom:8px}.ip-required{color:#ff4136;font-weight:700;margin-left:3px}.ip-modal .choices[data-type*=select-one] select.choices__input{bottom:0;display:block!important;left:0;opacity:0;pointer-events:none;position:absolute}.ip-modal .choices__list--single{padding:0}.ip-search-container input{margin-bottom:16px}.ip-field-error{color:#d32f2f;font-size:13px;margin-top:3px}.ip-error-input{border-color:#d32f2f!important}");k('.ip-modal .ip-button,.ip-modal button{background-color:var(--ip-button-bg);border:0 solid var(--ip-button-border);border-radius:24px;color:var(--ip-button-text);cursor:pointer;font-weight:600;letter-spacing:.5px;overflow:hidden;padding:12px 20px;transition:all .3s ease}.ip-modal .ip-button-mini{padding:2px 10px}.ip-modal .ip-button-red{background-color:#e93870}.ip-modal .ip-button-red:hover{background-color:#ff0051}.ip-modal .ip-button-yellow{background-color:#fff2c4;color:#644d0d}.ip-modal .ip-button-yellow:hover{background-color:#fae9ac}.ip-modal .ip-button:disabled,.ip-modal button:disabled{background-color:var(--ip-button-disabled);color:var(--ip-button-text-disabled);cursor:not-allowed}.ip-modal .ip-button-light{background-color:var(--ip-button-close-bg);border:0 solid var(--ip-button-close-border);color:var(--ip-button-close-text)}.ip-side-container .ip-button-rounded{margin-right:30px;margin-top:-15px}.ip-modal .ip-button-light:hover{background-color:var(--ip-button-close-hover)}.ip-modal .ip-button:hover,.ip-modal button:hover{background-color:var(--ip-button-hover);box-shadow:0 4px 10px rgba(0,0,0,.2);transform:translateY(-2px)}.ip-modal button:active{box-shadow:0 2px 5px rgba(0,0,0,.2);transform:translateY(0)}.ip-modal button:after{background:hsla(0,0%,100%,.5);border-radius:100%;content:"";height:5px;left:50%;opacity:0;position:absolute;top:50%;transform:scale(1) translate(-50%);transform-origin:50% 50%;width:5px}.ip-modal .ip-button:focus:not(:active):after,.ip-modal button:focus:not(:active):after{animation:ripple 1s ease-out}.ip-modal .ip-button-rounded{align-items:center;border-radius:30px;display:flex;height:30px;justify-content:center;padding:0;width:30px}.ip-side-close{font-size:13px!important}@keyframes ripple{0%{opacity:1;transform:scale(0)}20%{opacity:1;transform:scale(25)}to{opacity:0;transform:scale(40)}}');k(".ip-info-message{border-radius:4px;font-weight:500;margin-bottom:20px;overflow:hidden;padding:12px 40px 12px 16px;position:relative;transition:all .3s ease}.ip-info-message-main{font-weight:700;margin:0}.ip-info-message-description{font-size:12px;margin:0}.ip-info-message.info{background-color:#e3f2fd;border-left:4px solid #2196f3;color:#0d47a1}.ip-info-message.error{background-color:#ffebee;border-left:4px solid #f44336;color:#b71c1c}.ip-info-message.success{background-color:#e8f5e9;border-left:4px solid #4caf50;color:#1b5e20}.ip-info-message:hover{transform:translateY(-2px)}.ip-progress-bar{background-color:rgba(0,0,0,.2);bottom:0;height:4px;left:0;position:absolute;transform-origin:left;width:100%}@keyframes shrink{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.ip-info-message-close{background:none;border:none;color:inherit;cursor:pointer;font-size:20px;opacity:.7;position:absolute;right:10px;top:50%;transform:translateY(-50%);transition:opacity .3s ease}.ip-info-message-close:hover{opacity:1}");k(".ip-results-list{border:1px solid var(--ip-border);border-radius:8px;list-style-type:none;margin:0 0 20px;overflow:hidden;padding:0}.ip-result-item{align-items:center;border-bottom:1px solid var(--ip-border);display:flex;justify-content:space-between;margin-bottom:0;padding:20px;transition:all .3s ease}.ip-result-item:last-child{border-bottom:none}.ip-result-item:hover{background-color:var(--ip-result-item-hover-bg);background-color:var(--ip-table-td-hover-bg);cursor:pointer}.ip-result-left{align-items:flex-start;display:flex;flex-direction:column;flex-grow:1;justify-content:center;margin-right:1rem}.ip-result-right{align-items:center;display:flex;flex-shrink:0}.ip-result-details,.ip-result-header{text-align:left;width:100%}.ip-result-details{flex-direction:column;justify-content:center}.ip-result-header h3{color:var(--ip-text);font-size:14px!important;font-weight:600;letter-spacing:.5px;margin:0;text-transform:uppercase}.ip-preferred-name{font-style:italic;font-weight:400;margin:4px 0 0}.ip-result-details{display:flex;flex-wrap:wrap;gap:12px}.ip-result-details p{margin:0}.ip-result-details i{margin-right:8px;transition:transform .2s ease}.ip-high{color:#28a745}.ip-medium{color:#ff6507}.ip-low{color:#dc3545}.ip-highlight{background-color:rgba(255,0,0,.2);border-radius:2px;padding:0 2px}");k(".ip-results-container,.ip-search-container{opacity:0;pointer-events:none;transform:translateY(20px);transition:opacity .3s ease,transform .3s ease}.ip-results-container.active,.ip-search-container.active{opacity:1;pointer-events:auto;transform:translateY(0)}@keyframes fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.ip-result-item,.ip-timeline-item{animation:fadeIn .5s ease forwards;opacity:0;transform:translateY(20px)}.ip-result-item:first-child,.ip-timeline-item:first-child{animation-delay:.1s}.ip-result-item:nth-child(2),.ip-timeline-item:nth-child(2){animation-delay:.2s}.ip-result-item:nth-child(3),.ip-timeline-item:nth-child(3){animation-delay:.3s}.ip-result-item:nth-child(4),.ip-timeline-item:nth-child(4){animation-delay:.4s}.ip-result-item:nth-child(5),.ip-timeline-item:nth-child(5){animation-delay:.5s}.ip-result-item:nth-child(6),.ip-timeline-item:nth-child(6){animation-delay:.6s}.ip-result-item:nth-child(7),.ip-timeline-item:nth-child(7){animation-delay:.7s}.ip-result-item:nth-child(8),.ip-timeline-item:nth-child(8){animation-delay:.8s}.ip-result-item:nth-child(9),.ip-timeline-item:nth-child(9){animation-delay:.9s}.ip-result-item:nth-child(10),.ip-timeline-item:nth-child(10){animation-delay:1s}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}to{transform:scale(1)}}.ip-modal button:focus{animation:pulse .5s ease-in-out}");k("");k(".ip-table{border:1px solid var(--ip-border);border-collapse:separate;border-radius:10px;border-spacing:0;margin-bottom:20px;margin-top:10px;overflow:hidden;width:100%}.ip-table td,.ip-table th{border:none;padding:12px 16px;text-align:left;word-break:auto-phrase}.ip-table th{background-color:var(--ip-thead-bg);color:var(--ip-thead-color);font-size:10px!important;font-weight:600;letter-spacing:.5px;text-transform:uppercase}.ip-table tr{background-color:var(--ip-bg)}.ip-table tr:hover{background-color:var(--ip-table-td-hover-bg);transition:background-color .3s ease}.ip-table td{border-top:1px solid var(--ip-border)}.ip-table tr:first-child td{border-top:none}@keyframes highlight{0%{background-color:rgba(0,0,0,.1)}to{background-color:transparent}}.ip-table tr:target{animation:highlight 2s ease-out}.ip-table-separator{background:var(--ip-table-separator-bg);font-weight:700}.ip-description{margin-bottom:5px!important}");k(".ip-info-tags{display:flex;flex-wrap:nowrap;gap:10px;margin-bottom:20px;margin-top:20px;width:100%}.ip-info-tag{align-items:center;border-radius:6px;border-style:solid;border-width:1px;display:flex;flex:1;flex-direction:column;font-size:13px;justify-content:center;padding:10px;text-align:center}.ip-info-tag strong{display:block}.ip-tag-default{background-color:var(--ip-tag-bg-default)!important;border-color:var(--ip-tag-border-default);color:var(--ip-tag-text-default)}.ip-tag-success{background-color:var(--ip-tag-bg-success)!important;border-color:var(--ip-tag-border-success);color:var(--ip-tag-text-success)}.ip-tag-warning{background-color:var(--ip-tag-bg-warning)!important;border-color:var(--ip-tag-border-warning);color:var(--ip-tag-text-warning)}.ip-tag-error{background-color:var(--ip-tag-bg-error)!important;border-color:var(--ip-tag-border-error);color:var(--ip-tag-text-error)}.ip-tag-identity{background-color:var(--ip-tag-bg-blue)!important;border-color:var(--ip-tag-border-blue);color:var(--ip-tag-text-blue)}.ip-tag-attribute{background-color:var(--ip-tag-bg-purple)!important;border-color:var(--ip-tag-border-purple);color:var(--ip-tag-text-purple)}.ip-tag-green{background-color:var(--ip-tag-bg-green)!important;border-color:var(--ip-tag-border-green);color:var(--ip-tag-text-green)}.ip-tag-task{background-color:var(--ip-tag-bg-yellow)!important;border-color:var(--ip-tag-border-yellow);color:var(--ip-tag-text-yellow)}.ip-mini-tag{background:var(--ip-border);border-radius:6px;display:inline-block;font-size:12px;font-weight:700;letter-spacing:.1rem;margin:2px;padding:2px 5px}");k(".ip-loading-container{align-items:center;background-color:hsla(0,0%,100%,.9);bottom:0;display:none;flex-direction:column;justify-content:center;left:0;opacity:0;position:absolute;right:0;top:0;transform:scale(.95);transition:opacity .3s ease,transform .3s ease;z-index:1000}.ip-loading-container.show{opacity:1;transform:scale(1)}.ip-loader{animation:spin 1s linear infinite;border:5px solid #f3f3f3;border-radius:50%;border-top-color:#000;height:40px;width:40px}.ip-loading-message{color:#333;font-size:16px;margin-top:20px;opacity:0;text-align:center;transform:translateY(10px);transition:opacity .3s ease .1s,transform .3s ease .1s}.ip-loading-container.show .ip-loading-message{opacity:1;transform:translateY(0)}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}");k(".ip-timeline{border-left:1px solid var(--ip-border);margin-left:6px}.ip-timeline,.ip-timeline-item{position:relative}.ip-timeline-point{background-color:var(--ip-border);border-radius:50%;height:12px;left:-7px;position:absolute;top:21px;width:12px}.ip-timeline-content{padding:15px}.ip-timeline-content .date{color:var(--ip-text-light);font-size:12px;letter-spacing:.1rem;margin:0}.ip-timeline-content .code{color:var(--ip-text-extra-light);font-size:10px;margin:0}button.ip-copy-button{background:#fff;color:var(--ip-text);font-size:10px;margin-top:5px;padding:5px}button.ip-copy-button:hover{background:var(--ip-table-td-hover-bg)}.ip-identity-change-header{margin-bottom:10px}.ip-timeline .change-type{color:var(--ip-text);font-weight:700;margin-bottom:5px}.ip-identity-change-header .change-info{color:#6c757d;font-size:.9em}.ip-change-status{color:#28a745;font-style:italic;margin-bottom:5px}.ip-change-message{color:#6c757d;display:block;font-size:.9em;margin-bottom:10px}.ip-attribute-changes-table{border-collapse:collapse;margin-top:10px;width:100%}.ip-attribute-changes-table td,.ip-attribute-changes-table th{border:1px solid #dee2e6;padding:8px;text-align:left}.ip-attribute-changes-table th{background-color:#e9ecef;font-weight:700}.ip-attribute-changes-table tr:nth-child(2n){background-color:#f8f9fa}.ip-date-and-types{align-items:center;display:flex;justify-content:space-between;margin-bottom:10px}.ip-event-types{color:#666;font-size:.9em}.ip-event-type{margin-right:5px}.ip-event-type.identity{color:#007bff}.ip-event-type.attribute{color:#28a745}.ip-event-type.task{color:#ffc107}.ip-search-bar{background-color:var(--ip-table-separator-bg);padding-bottom:20px;padding-top:20px;position:sticky;top:0;z-index:2}.ip-search-input{border-radius:40px!important}.ip-side-container .ip-content-area{padding-right:25px;padding-top:10px}.ip-view-task-history{background-color:var(--ip-primary);border:none;border-radius:4px;color:#fff;cursor:pointer;margin-top:10px;padding:5px 10px}.ip-view-task-history:hover{background-color:var(--ip-primary-dark)}.ip-full-task-history{padding:20px}.ip-task-history-item{border-bottom:1px solid var(--ip-border);padding:10px 0}.ip-task-history-item span{display:block;margin-bottom:5px}.ip-task-history-date{font-weight:700}.ip-task-history-author,.ip-task-history-change,.ip-task-history-status{color:var(--ip-text-light)}");k('.choices{font-size:16px;margin-bottom:24px;overflow:hidden;position:relative}.choices:focus{outline:0}.choices:last-child{margin-bottom:0}.choices.is-open{overflow:visible}.choices.is-disabled .choices__inner,.choices.is-disabled .choices__input{background-color:#eaeaea;cursor:not-allowed;-webkit-user-select:none;user-select:none}.choices.is-disabled .choices__item{cursor:not-allowed}.choices [hidden]{display:none!important}.choices[data-type*=select-one]{cursor:pointer}.choices[data-type*=select-one] .choices__inner{padding-bottom:7.5px}.choices[data-type*=select-one] .choices__input{background-color:#fff;border-bottom:1px solid #ddd;display:block;margin:0;padding:10px;width:100%}.choices[data-type*=select-one] .choices__button{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjEiIGhlaWdodD0iMjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJtMi41OTIuMDQ0IDE4LjM2NCAxOC4zNjQtMi41NDggMi41NDhMLjA0NCAyLjU5MnoiLz48cGF0aCBkPSJNMCAxOC4zNjQgMTguMzY0IDBsMi41NDggMi41NDhMMi41NDggMjAuOTEyeiIvPjwvZz48L3N2Zz4=);background-size:8px;border-radius:10em;height:20px;margin-right:25px;margin-top:-10px;opacity:.25;padding:0;position:absolute;right:0;top:50%;width:20px}.choices[data-type*=select-one] .choices__button:focus,.choices[data-type*=select-one] .choices__button:hover{opacity:1}.choices[data-type*=select-one] .choices__button:focus{box-shadow:0 0 0 2px #005f75}.choices[data-type*=select-one] .choices__item[data-placeholder] .choices__button{display:none}.choices[data-type*=select-one]:after{border:5px solid transparent;border-top-color:#333;content:"";height:0;margin-top:-2.5px;pointer-events:none;position:absolute;right:11.5px;top:50%;width:0}.choices[data-type*=select-one].is-open:after{border-color:transparent transparent #333;margin-top:-7.5px}.choices[data-type*=select-one][dir=rtl]:after{left:11.5px;right:auto}.choices[data-type*=select-one][dir=rtl] .choices__button{left:0;margin-left:25px;margin-right:0;right:auto}.choices[data-type*=select-multiple] .choices__inner,.choices[data-type*=text] .choices__inner{cursor:text}.choices[data-type*=select-multiple] .choices__button,.choices[data-type*=text] .choices__button{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjEiIGhlaWdodD0iMjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI0ZGRiIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJtMi41OTIuMDQ0IDE4LjM2NCAxOC4zNjQtMi41NDggMi41NDhMLjA0NCAyLjU5MnoiLz48cGF0aCBkPSJNMCAxOC4zNjQgMTguMzY0IDBsMi41NDggMi41NDhMMi41NDggMjAuOTEyeiIvPjwvZz48L3N2Zz4=);background-size:8px;border-left:1px solid #003642;border-radius:0;display:inline-block;line-height:1;margin:0-4px 0 8px;opacity:.75;padding-left:16px;position:relative;width:8px}.choices[data-type*=select-multiple] .choices__button:focus,.choices[data-type*=select-multiple] .choices__button:hover,.choices[data-type*=text] .choices__button:focus,.choices[data-type*=text] .choices__button:hover{opacity:1}.choices__inner{background-color:#f9f9f9;border:1px solid #ddd;border-radius:2.5px;display:inline-block;font-size:14px;min-height:44px;overflow:hidden;padding:7.5px 7.5px 3.75px;vertical-align:top;width:100%}.is-focused .choices__inner,.is-open .choices__inner{border-color:#b7b7b7}.is-open .choices__inner{border-radius:2.5px 2.5px 0 0}.is-flipped.is-open .choices__inner{border-radius:0 0 2.5px 2.5px}.choices__list{list-style:none;margin:0;padding-left:0}.choices__list--single{display:inline-block;padding:4px 16px 4px 4px;width:100%}[dir=rtl] .choices__list--single{padding-left:16px;padding-right:4px}.choices__list--single .choices__item{width:100%}.choices__list--multiple{display:inline}.choices__list--multiple .choices__item{background-color:#005f75;border:1px solid #004a5c;border-radius:20px;box-sizing:border-box;color:#fff;display:inline-block;font-size:12px;font-weight:500;margin-bottom:3.75px;margin-right:3.75px;padding:4px 10px;vertical-align:middle;word-break:break-all}.choices__list--multiple .choices__item[data-deletable]{padding-right:5px}[dir=rtl] .choices__list--multiple .choices__item{margin-left:3.75px;margin-right:0}.choices__list--multiple .choices__item.is-highlighted{background-color:#004a5c;border:1px solid #003642}.is-disabled .choices__list--multiple .choices__item{background-color:#aaa;border:1px solid #919191}.choices__list--dropdown,.choices__list[aria-expanded]{background-color:#fff;border:1px solid #ddd;border-bottom-left-radius:2.5px;border-bottom-right-radius:2.5px;display:none;margin-top:-1px;overflow:hidden;position:absolute;top:100%;width:100%;word-break:break-all;z-index:1}.is-active.choices__list--dropdown,.is-active.choices__list[aria-expanded]{display:block}.is-open .choices__list--dropdown,.is-open .choices__list[aria-expanded]{border-color:#b7b7b7}.is-flipped .choices__list--dropdown,.is-flipped .choices__list[aria-expanded]{border-radius:.25rem .25rem 0 0;bottom:100%;margin-bottom:-1px;margin-top:0;top:auto}.choices__list--dropdown .choices__list,.choices__list[aria-expanded] .choices__list{-webkit-overflow-scrolling:touch;max-height:300px;overflow:auto;position:relative;will-change:scroll-position}.choices__list--dropdown .choices__item,.choices__list[aria-expanded] .choices__item{font-size:14px;padding:10px;position:relative}[dir=rtl] .choices__list--dropdown .choices__item,[dir=rtl] .choices__list[aria-expanded] .choices__item{text-align:right}@media (min-width:640px){.choices__list--dropdown .choices__item--selectable[data-select-text],.choices__list[aria-expanded] .choices__item--selectable[data-select-text]{padding-right:100px}.choices__list--dropdown .choices__item--selectable[data-select-text]:after,.choices__list[aria-expanded] .choices__item--selectable[data-select-text]:after{content:attr(data-select-text);font-size:12px;opacity:0;position:absolute;right:10px;top:50%;transform:translateY(-50%)}[dir=rtl] .choices__list--dropdown .choices__item--selectable[data-select-text],[dir=rtl] .choices__list[aria-expanded] .choices__item--selectable[data-select-text]{padding-left:100px;padding-right:10px;text-align:right}[dir=rtl] .choices__list--dropdown .choices__item--selectable[data-select-text]:after,[dir=rtl] .choices__list[aria-expanded] .choices__item--selectable[data-select-text]:after{left:10px;right:auto}}.choices__list--dropdown .choices__item--selectable.is-highlighted,.choices__list[aria-expanded] .choices__item--selectable.is-highlighted{background-color:#f2f2f2}.choices__list--dropdown .choices__item--selectable.is-highlighted:after,.choices__list[aria-expanded] .choices__item--selectable.is-highlighted:after{opacity:.5}.choices__item{cursor:default}.choices__item--selectable{cursor:pointer}.choices__item--disabled{cursor:not-allowed;opacity:.5;-webkit-user-select:none;user-select:none}.choices__heading{border-bottom:1px solid #f7f7f7;color:gray;font-size:12px;font-weight:600;padding:10px}.choices__button{appearance:none;background-color:transparent;background-position:50%;background-repeat:no-repeat;border:0;cursor:pointer;text-indent:-9999px}.choices__button:focus,.choices__input:focus{outline:0}.choices__input{background-color:#f9f9f9;border:0;border-radius:0;display:inline-block;font-size:14px;margin-bottom:5px;max-width:100%;padding:4px 0 4px 2px;vertical-align:baseline}.choices__input::-webkit-search-cancel-button,.choices__input::-webkit-search-decoration,.choices__input::-webkit-search-results-button,.choices__input::-webkit-search-results-decoration{display:none}.choices__input::-ms-clear,.choices__input::-ms-reveal{display:none;height:0;width:0}[dir=rtl] .choices__input{padding-left:0;padding-right:2px}.choices__placeholder{opacity:.5}');var x={choices:{minSearchLength:3,debounceTime:300},display:{modalMaxHeight:.9},endpoints:{permissions:"rest/identitypicker/api/permissions",search:"rest/identitypicker/api/search",identity:"rest/identitypicker/api/identity",rules:"rest/identitypicker/api/rules",history:"history",countries:"rest/geocodesclient/api/v1/countries",cities:"rest/geocodesclient/api/v1/cities"},autoFill:!1,selection:!0,cuid:null,fieldMapping:{}},w={identity:{label:"Identit√©",attributes:["gender","name","family_name","preferred_username","first_name"]},birth:{label:"Naissance",attributes:["birthdate","birthcountry","birthcountry_code","birthplace","birthplace_code"]},contact:{label:"Contact",attributes:["login","email","mobile_phone","fixed_phone"]},address:{label:"Adresse",attributes:["address","address_detail","address_postal_code","address_city"]}};function C(e,t){var i;return function(){for(var n=this,r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];clearTimeout(i),i=setTimeout((function(){return e.apply(n,o)}),t)}}function E(e,t){var i=e.attributes.find((function(e){return e.key===t}));return i?i.value:""}function S(e){return new Date(e).toLocaleDateString("fr-FR")}var L=function(){return a((function e(t){r(this,e),this.identityPicker=t,this.uniqueId=t.uniqueId,this.emailForm=null,this.nameForm=null}),[{key:"initSearchView",value:(o=i(f().mark((function e(){var t,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.identityPicker.searchContainer,i='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-top: -2px;"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>',t.innerHTML='\n      <div class="ip-search-option">\n        <label>\n          <input type="radio" name="searchType" value="email">\n          <span>'.concat(this.identityPicker.rules.language.searchByEmail,'</span>\n        </label>\n        <label>\n          <input type="radio" name="searchType" value="name" checked>\n          <span>').concat(this.identityPicker.rules.language.searchByName,'</span>\n        </label>\n      </div>\n      <form id="ip-email-form-').concat(this.uniqueId,'" style="display: none;">\n        <input type="email" placeholder="').concat(this.identityPicker.rules.language.emailPlaceholder,'" name="email" required>\n        <div class="ip-container-buttons">\n          <button class="ip-button-light" type="button">').concat(this.identityPicker.rules.language.closeButton,'</button>\n          <button type="submit">').concat(i," ").concat(this.identityPicker.rules.language.searchButton,'</button>\n        </div>\n      </form>\n      <form id="ip-name-form-').concat(this.uniqueId,'">\n        <input type="text" placeholder="').concat(this.identityPicker.rules.language.firstNamePlaceholder,'" name="firstName" value="sebastien" required>\n        <input type="text" placeholder="').concat(this.identityPicker.rules.language.lastNamePlaceholder,'" name="lastName" value="leridon" required>\n        <input type="date" placeholder="').concat(this.identityPicker.rules.language.birthdatePlaceholder,'" name="birthdate" value="1971-12-27" required>\n        <div class="ip-container-buttons">\n          <button class="ip-button-light ip-button-close" type="button">').concat(this.identityPicker.rules.language.closeButton,'</button>\n          <button type="submit">').concat(i," ").concat(this.identityPicker.rules.language.searchButton,"</button>\n        </div>\n      </form>\n    "),this.emailForm=t.querySelector("#ip-email-form-".concat(this.uniqueId)),this.nameForm=t.querySelector("#ip-name-form-".concat(this.uniqueId)),this.closeBtn=t.querySelector(".ip-button-close"),e.next=8,this.setupSearchForms();case 8:return e.next=10,this.setupResultsClickHandler();case 10:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"setupSearchForms",value:(n=i(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.identityPicker.searchContainer.querySelectorAll('input[name="searchType"]').forEach((function(e){e.addEventListener("change",(function(){return t.toggleSearchForm(e.value)}))})),this.emailForm.addEventListener("submit",(function(e){e.preventDefault(),t.performSearch(new FormData(t.emailForm),"email")})),this.nameForm.addEventListener("submit",(function(e){e.preventDefault(),t.performSearch(new FormData(t.nameForm),"name")})),this.closeBtn.addEventListener("click",(function(){return t.identityPicker.closeModal()}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"toggleSearchForm",value:function(e){this.emailForm.style.display="email"===e?"block":"none",this.nameForm.style.display="name"===e?"block":"none",this.identityPicker.adjustModalHeight()}},{key:"performSearch",value:(t=i(f().mark((function e(t,i){var n,r,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.identityPicker.showLoading(this.identityPicker.rules.language.loading),n=this.buildSearchUrl(t,i),e.prev=2,e.next=5,fetch(n);case 5:if(404!==(r=e.sent).status){e.next=9;break}return this.identityPicker.showInfoMessage("noResults","info"),e.abrupt("return");case 9:if(r.ok){e.next=11;break}throw new Error("".concat(this.identityPicker.rules.language.httpError," ").concat(r.status));case 11:return e.next=13,r.json();case 13:o=e.sent,this.displayResults(o),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(2),console.error(this.identityPicker.rules.language.fetchError,e.t0),this.identityPicker.showInfoMessage("errorMessage","error",e.t0.message);case 21:return e.prev=21,this.identityPicker.hideLoading(),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[2,17,21,24]])}))),function(e,i){return t.apply(this,arguments)})},{key:"buildSearchUrl",value:function(e,t){var i=this.identityPicker.config.endpoints.search+"?";if("email"===t)return"".concat(i,"email=").concat(encodeURIComponent(e.get("email")));var n=S(e.get("birthdate"));return"".concat(i,"common_lastname=").concat(e.get("lastName"),"&first_name=").concat(e.get("firstName"),"&birthdate=").concat(n)}},{key:"displayResults",value:function(e){var t=this,i=this.identityPicker.resultsContainer;if(0===e.length)return this.identityPicker.showInfoMessage("noResults","info"),void this.addCreateIdentityButton();var n=e.map((function(e){return t.createResultItem(e)})).join("");i.innerHTML='<ul class="ip-results-list">'.concat(n,"</ul>"),this.addCreateIdentityButton(),this.identityPicker.showResultsView(),this.identityPicker.adjustModalHeight()}},{key:"createResultItem",value:function(e){var t=this.getSearchData(),i=this.getAttributeValue(e,"first_name"),n=this.getAttributeValue(e,"family_name"),r=this.getAttributeValue(e,"preferred_username"),o=this.getAttributeValue(e,"birthdate"),a=this.getAttributeValue(e,"address"),s=this.getAttributeValue(e,"address_postal_code"),c=this.getAttributeValue(e,"address_city"),l=this.highlightDifferences(t.firstName,i),u=this.highlightLastNameDifferences(t.lastName,n,r),h=this.highlightDifferences(S(t.birthdate),o),d="".concat(l," ").concat(u),p=[h,[a,s,c].filter(Boolean).join(", ")].filter(Boolean).join(" | "),f=e.quality,g=(100*f.scoring).toFixed(2),m=(100*f.quality).toFixed(2),v=(100*f.coverage).toFixed(2),y='\n      <span class="ip-info-tag '.concat(this.getBadgeColorClass(parseFloat(g)),'">\n        <strong>').concat(this.identityPicker.rules.language.qualityScore,"</strong> ").concat(g,"%\n      </span>\n    ");return'\n      <li class="ip-result-item" data-customer-id="'.concat(e.customer_id,'">\n        <div class="ip-result-left">\n          <div class="ip-result-header">\n            <h3>').concat(d,'</h3>\n          </div>\n          <div class="ip-result-details">\n            <p>').concat(p,"</p>\n            <p>\n              ").concat(this.identityPicker.rules.language.qualityLabel,': <span class="').concat(this.getColorClass(parseFloat(m)),'">').concat(m,"%</span> |\n              ").concat(this.identityPicker.rules.language.coverageLabel,': <span class="').concat(this.getColorClass(parseFloat(v)),'">').concat("".concat(v<100?this.identityPicker.rules.language.incomplete:this.identityPicker.rules.language.complete),'</span>\n            </p>\n          </div>\n        </div>\n        <div class="ip-result-right">\n          ').concat(y,"\n        </div>\n      </li>\n    ")}},{key:"addCreateIdentityButton",value:function(){var e=this,t=document.createElement("div");t.classList.add("ip-container-buttons");var i=document.createElement("button");i.textContent=this.identityPicker.rules.language.backButton,i.classList.add("ip-button-light"),i.addEventListener("click",(function(){return e.identityPicker.showSearchView()}));var n=document.createElement("button");n.textContent=this.identityPicker.rules.language.createButton,n.classList.add("ip-create-button"),n.addEventListener("click",(function(){return e.identityPicker.identityForm.showCreateIdentityForm()})),t.appendChild(i),t.appendChild(n),this.identityPicker.resultsContainer.appendChild(t)}},{key:"getAttributeValue",value:function(e,t){var i=e.attributes.find((function(e){return e.key===t}));return i?i.value:""}},{key:"setupResultsClickHandler",value:(e=i(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.identityPicker.resultsContainer.addEventListener("click",(function(e){var i=e.target.closest(".ip-result-item");if(i){var n=i.dataset.customerId;t.identityPicker.identityView.loadIdentityDetails(n)}}));case 1:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"getBadgeColorClass",value:function(e){return e>=80?"ip-tag-success":e>=50?"ip-tag-warning":"ip-tag-error"}},{key:"getColorClass",value:function(e){return e>=80?"ip-high":e>=50?"ip-medium":"ip-low"}},{key:"getSearchData",value:function(){var e=document.getElementById("ip-name-form-".concat(this.uniqueId));return{firstName:e.querySelector('input[name="firstName"]').value,lastName:e.querySelector('input[name="lastName"]').value,birthdate:e.querySelector('input[name="birthdate"]').value}}},{key:"removeAccents",value:function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}},{key:"highlightDifferences",value:function(e,t){if(!e||!t)return t;for(var i=this.removeAccents(e.toLowerCase()),n=this.removeAccents(t.toLowerCase()),r="",o=0,a=!1,s=0;s<t.length;s++)o<i.length&&n[s]===i[o]?(a&&(r+="</span>",a=!1),r+=t[s],o++):(a||(r+='<span class="ip-highlight">',a=!0),r+=t[s]);return a&&(r+="</span>"),r}},{key:"highlightLastNameDifferences",value:function(e,t,i){var n=this.highlightDifferences(e,t),r=i?this.highlightDifferences(e,i):"";return i?(n.match(/<span class="ip-highlight">/g)||[]).length<=(r.match(/<span class="ip-highlight">/g)||[]).length?"".concat(n,' <span class="ip-preferred-name">(').concat(i,")</span>"):"".concat(t,' <span class="ip-preferred-name">(').concat(r,")</span>"):n}}]);var e,t,n,o}(),I=function(){return a((function e(t){r(this,e),this.identityPicker=t}),[{key:"autoFillIdentity",value:(n=i(f().mark((function e(t){var i,n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(this.identityPicker.config.endpoints.identity,"/").concat(t),e.prev=1,e.next=4,fetch(i);case 4:if((n=e.sent).ok){e.next=7;break}throw new Error("".concat(this.identityPicker.rules.language.httpError," ").concat(n.status));case 7:return e.next=9,n.json();case 9:r=e.sent,this.fillFields(r),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),console.error(this.identityPicker.rules.language.fetchError,e.t0);case 16:return e.prev=16,e.finish(16);case 18:case"end":return e.stop()}}),e,this,[[1,13,16,18]])}))),function(e){return n.apply(this,arguments)})},{key:"loadIdentityDetails",value:(t=i(f().mark((function e(t){var i,n,r,o,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.identityPicker.showLoading(),i="".concat(this.identityPicker.config.endpoints.identity,"/").concat(t),e.prev=2,e.next=5,fetch(i);case 5:if((n=e.sent).ok){e.next=8;break}throw n;case 8:return e.next=10,n.json();case 10:r=e.sent,this.displayIdentityDetails(r),e.next=20;break;case 14:e.prev=14,e.t0=e.catch(2),console.error(this.identityPicker.rules.language.fetchError,e.t0),o=e.t0 instanceof Response?403===e.t0.status?"".concat(this.identityPicker.rules.language.httpError," 403"):"".concat(this.identityPicker.rules.language.httpError," ").concat(e.t0.status):e.t0.message,a=o.includes("403")?"noPermissions":"errorMessage",this.identityPicker.showInfoMessage(a,"error",o);case 20:return e.prev=20,this.identityPicker.hideLoading(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[2,14,20,23]])}))),function(e){return t.apply(this,arguments)})},{key:"displayIdentityDetails",value:function(e){var t=this.identityPicker.detailsContainer,i=E(e,"first_name"),n=E(e,"family_name"),r=E(e,"preferred_username"),o=this.generateHeaderHTML(e,i,n,r),a=this.generateAttributesTable(e);t.innerHTML=o+a,this.setupButtons(e),this.identityPicker.showDetailsView()}},{key:"generateHeaderHTML",value:function(e,t,i,n){var r=this.identityPicker.modal.getAttribute("data-cuid")!==e.customer_id,o=e.attributes.find((function(e){return"email"===e.key})),a=o&&o.value&&""!==o.value.trim(),s=o&&"DEC"===o.certProcess,c=a&&s&&this.identityPicker.permissions.create_task,l=this.canCreateAccount(e)&&this.identityPicker.permissions.create_task;return'\n      <div class="ip-container-header">\n        <div>\n          <h3 class="ip-truncate">'.concat(t," ").concat(i).concat(n?" (".concat(n,")"):"",'</h3>\n          <p class="ip-truncate ip-description">').concat(e.customer_id,"</p>\n            ").concat(c?'<button class="ip-validate-email-btn ip-button-mini ip-button-yellow">‚ö†Ô∏è '.concat(this.identityPicker.rules.language.validateEmailButton,"</button>"):"",'\n        </div>\n      <div class="ip-container-header-btns">\n        <button class="ip-history-btn">').concat(this.identityPicker.rules.language.historyButton,"</button>\n        ").concat(this.identityPicker.permissions.update?'<button class="ip-modify-btn">'.concat(this.identityPicker.rules.language.modifyButton,"</button>"):"","\n        ").concat(Object.keys(this.identityPicker.config.fieldMapping||{}).length>0&&this.identityPicker.config.selection?'<button class="ip-select-btn" '.concat(r?"":"disabled",">").concat("".concat(r?this.identityPicker.rules.language.selectButton:this.identityPicker.rules.language.selectedButton),"</button>"):"",'\n      </div>\n      </div>\n      <div class="ip-info-tags">\n        <span class="ip-info-tag ip-tag-default">\n          <strong>').concat(this.identityPicker.rules.language.creationDate,"</strong> ").concat(S(e.creation_date),'\n        </span>\n        <span class="ip-info-tag ip-tag-default">\n          <strong>').concat(this.identityPicker.rules.language.lastUpdateDate,"</strong> ").concat(S(e.last_update_date),'\n        </span>\n        <span class="ip-info-tag ').concat(e.mon_paris_active?"ip-tag-success":"ip-tag-error",'">\n          <strong>').concat(this.identityPicker.rules.language.monParisAccount,"</strong> ").concat(e.mon_paris_active?this.identityPicker.rules.language.active:" ".concat(l?'<button class="ip-create-account-btn ip-button-mini ip-button-red">'.concat(this.identityPicker.rules.language.createAccountButton,"</button>"):this.identityPicker.rules.language.inactive),'\n        </span>\n        <span class="ip-info-tag ').concat(this.getCoverageClass(e.quality.coverage),'">\n          <strong>').concat(this.identityPicker.rules.language.coverage,"</strong> ").concat(1===e.quality.coverage?this.identityPicker.rules.language.complete:this.identityPicker.rules.language.incomplete,"\n        </span>\n      </div>")}},{key:"generateAttributesTable",value:function(e){for(var t=this,i=this.identityPicker.rules.contract.attributeDefinitions.filter((function(e){return e.attributeRight.readable})).map((function(t){var i=e.attributes.find((function(e){return e.key===t.keyName}));return{name:t.name,key:t.keyName,value:i?i.value:"",certification:i?i.certProcess:""}})),n=this.groupAttributes(i),r='\n      <table class="ip-table">\n        <tbody>',o=0,a=Object.entries(n);o<a.length;o++){var s=m(a[o],2),c=s[0],l=s[1];if(l.length>0){var u="other"===c?this.identityPicker.rules.language.otherGroup:this.identityPicker.rules.language["".concat(c,"Group")];r+='\n          <tr class="ip-group-separator">\n            <td class="ip-table-separator" colspan="3">'.concat(u,"</td>\n          </tr>"),l.forEach((function(e){var i=t.getCertificationInfo(e.key,e.certification),n=t.getDisplayValue(e.key,e.value);r+="\n            <tr>\n              <td>".concat(e.name,"</td>\n              <td><strong>").concat(n,'</strong></td>\n              <td>\n                <span title="').concat(i.description,'">').concat(i.label,"</span>\n              </td>\n            </tr>")}))}}return r+="\n        </tbody>\n      </table>"}},{key:"canCreateAccount",value:function(e){if(e.mon_paris_active)return!1;var t,i=this.identityPicker.rules.referential.attributeKeyList.attributeKeys.filter((function(e){return e.pivot})).map((function(e){return e.keyName})).sort((function(e,t){return e.localeCompare(t)})),n=null,r=s(i);try{var o,a=function(){var i=t.value,r=e.attributes.find((function(e){return e.key===i}));return"birthcountry_code"===i&&r&&(n=r.value),"birthplace_code"===i&&n&&"99100"!==n?0:r&&"ORIG1"===r.certProcess?void 0:{v:!1}};for(r.s();!(t=r.n()).done;)if(0!==(o=a())&&o)return o.v}catch(e){r.e(e)}finally{r.f()}return!0}},{key:"groupAttributes",value:function(e){var t=this,i={};return Object.keys(this.identityPicker.attributeGroups).forEach((function(e){i[e]=[]})),i.other=[],e.forEach((function(e){for(var n=!1,r=0,o=Object.entries(t.identityPicker.attributeGroups);r<o.length;r++){var a=m(o[r],2),s=a[0];if(a[1].attributes.includes(e.key)){i[s].push(e),n=!0;break}}n||i.other.push(e)})),Object.keys(i).forEach((function(e){"other"!==e&&i[e].sort((function(i,n){return t.identityPicker.attributeGroups[e].attributes.indexOf(i.key)-t.identityPicker.attributeGroups[e].attributes.indexOf(n.key)}))})),i}},{key:"getAttributeInfo",value:function(e){var t=this.identityPicker.rules.referential.attributeKeyList.attributeKeys.find((function(t){return t.keyName===e}));return{label:t?t.name:e,description:t?t.description:""}}},{key:"getCertificationInfo",value:function(e,t){var i=this.identityPicker.rules.referential.processList.processus.find((function(e){return e.code===t}));if(i){var n=i.attributeCertificationLevels.find((function(t){return t.attributeKey===e}));if(n)return{label:i.label,description:n.level.description}}return{label:t,description:this.identityPicker.rules.language.certificationUnavailable}}},{key:"getCoverageClass",value:function(e){return e<.5?"ip-tag-error":e<.8?"ip-tag-warning":"ip-tag-success"}},{key:"getDisplayValue",value:function(e,t){var i=this.identityPicker.rules.referential.attributeKeyList.attributeKeys.find((function(t){return t.keyName===e}));if(i&&i.values){var n=i.values.find((function(e){return e.value===t}));return n?n.label:t}return t}},{key:"fillFields",value:function(e){for(var t=function(){var t=m(n[i],2),r=t[0],o=t[1],a=document.getElementById(r);if(a){var s;if(o in e)s=e[o];else{var c=e.attributes.find((function(e){return e.key===o}));s=c?c.value:""}a instanceof HTMLInputElement||a instanceof HTMLSelectElement?a.value=s:a.textContent=s}},i=0,n=Object.entries(this.identityPicker.config.fieldMapping);i<n.length;i++)t();this.identityPicker.modal.setAttribute("data-cuid",e.customer_id),this.identityPicker.closeModal()}},{key:"setupButtons",value:function(e){var t=this,i=this.identityPicker.detailsContainer,n=i.querySelector(".ip-modify-btn"),r=i.querySelector(".ip-select-btn"),o=i.querySelector(".ip-history-btn"),a=i.querySelector(".ip-create-account-btn"),s=i.querySelector(".ip-validate-email-btn");null==n||n.addEventListener("click",(function(){t.identityPicker.identityForm.showModifyIdentityForm(e.customer_id)})),null==r||r.addEventListener("click",(function(){t.fillFields(e)})),null==o||o.addEventListener("click",(function(){t.identityPicker.identityHistory.loadGlobalHistory(e.customer_id)})),null==a||a.addEventListener("click",(function(){t.createIdentityTask(e.customer_id,"create-account-task")})),null==s||s.addEventListener("click",(function(){t.createIdentityTask(e.customer_id,"validate-email-task")}))}},{key:"createIdentityTask",value:(e=i(f().mark((function e(t,i){var n,r,o,a,s,c,l,u,h;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n="".concat(this.identityPicker.config.endpoints.identity,"/").concat(t,"/tasks/").concat(i),e.next=4,fetch(n,{method:"POST",headers:{"Content-Type":"application/json"}});case 4:return r=e.sent,e.next=7,r.json();case 7:if(o=e.sent,r.ok){e.next=12;break}return a=o.status&&o.status.message?o.status.message:this.identityPicker.rules.language.fetchError,this.identityPicker.showInfoMessage(this.identityPicker.rules.language.taskCreationFailed,"error",a),e.abrupt("return");case 12:s=o.task_code,c=this.identityPicker.rules.language.taskCreationSuccess,l="".concat(this.identityPicker.rules.language.taskCode,": ").concat(s),this.identityPicker.showInfoMessage(c,"success",l),e.next=36;break;case 18:if(e.prev=18,e.t0=e.catch(0),console.error(this.identityPicker.rules.language.fetchError,e.t0),!(e.t0 instanceof Response)){e.next=34;break}return e.prev=22,e.next=25,e.t0.json();case 25:h=e.sent,u=h.status&&h.status.message?h.status.message:e.t0.statusText||this.identityPicker.rules.language.fetchError,e.next=32;break;case 29:e.prev=29,e.t1=e.catch(22),u=e.t0.statusText||this.identityPicker.rules.language.fetchError;case 32:e.next=35;break;case 34:u=e.t0.message||this.identityPicker.rules.language.fetchError;case 35:this.identityPicker.showInfoMessage(this.identityPicker.rules.language.taskCreationFailed,"error",u);case 36:case"end":return e.stop()}}),e,this,[[0,18],[22,29]])}))),function(t,i){return e.apply(this,arguments)})}]);var e,t,n}(),M=function(e,t){return M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},M(e,t)};function P(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}M(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var T=function(){return T=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},T.apply(this,arguments)};function A(e,t,i){for(var n,r=0,o=t.length;r<o;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var O,N="ADD_CHOICE",F="REMOVE_CHOICE",j="FILTER_CHOICES",D="ACTIVATE_CHOICES",R="CLEAR_CHOICES",q="ADD_GROUP",B="ADD_ITEM",H="REMOVE_ITEM",V="HIGHLIGHT_ITEM",z="showDropdown",K="hideDropdown",G="change",$="choice",W="search",U="addItem",Y="removeItem",J="highlightItem",Z="highlightChoice",Q="unhighlightItem",X=["fuseOptions","classNames"],ee="text",te="select-one",ie="select-multiple",ne=function(e){return{type:F,choice:e}},re=function(e){return{type:H,item:e}},oe=function(e,t){return{type:V,item:e,highlighted:t}},ae=function(e){return Array.from({length:e},(function(){return(e=0,t=36,Math.floor(Math.random()*(t-e)+e)).toString(36);var e,t})).join("")},se=function(e){if("string"!=typeof e){if(null==e)return"";if("object"===b(e)){if("raw"in e)return se(e.raw);if("trusted"in e)return e.trusted}return e}return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},ce=(O=document.createElement("div"),function(e){O.innerHTML=e.trim();for(var t=O.children[0];O.firstChild;)O.removeChild(O.firstChild);return t}),le=function(e,t){return"function"==typeof e?e(se(t),t):e},ue=function(e){return"function"==typeof e?e():e},he=function(e){if("string"==typeof e)return e;if("object"===b(e)){if("trusted"in e)return e.trusted;if("raw"in e)return e.raw}return""},de=function(e,t){return e?function(e){if("string"==typeof e)return e;if("object"===b(e)){if("escaped"in e)return e.escaped;if("trusted"in e)return e.trusted}return""}(t):se(t)},pe=function(e,t,i){e.innerHTML=de(t,i)},fe=function(e,t){return e.rank-t.rank},ge=function(e){return Array.isArray(e)?e:[e]},me=function(e){return e&&Array.isArray(e)?e.map((function(e){return".".concat(e)})).join(""):".".concat(e)},ve=function(e,t){var i;(i=e.classList).add.apply(i,ge(t))},ye=function(e,t){var i;(i=e.classList).remove.apply(i,ge(t))},be=function(e){if(void 0!==e)try{return JSON.parse(e)}catch(t){return e}return{}},_e=function(){function e(e){var t=e.element,i=e.type,n=e.classNames;this.element=t,this.classNames=n,this.type=i,this.isActive=!1}return e.prototype.show=function(){return ve(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","true"),this.isActive=!0,this},e.prototype.hide=function(){return ye(this.element,this.classNames.activeState),this.element.setAttribute("aria-expanded","false"),this.isActive=!1,this},e}(),ke=function(){function e(e){var t=e.element,i=e.type,n=e.classNames,r=e.position;this.element=t,this.classNames=n,this.type=i,this.position=r,this.isOpen=!1,this.isFlipped=!1,this.isDisabled=!1,this.isLoading=!1}return e.prototype.shouldFlip=function(e,t){var i=!1;return"auto"===this.position?i=this.element.getBoundingClientRect().top-t>=0&&!window.matchMedia("(min-height: ".concat(e+1,"px)")).matches:"top"===this.position&&(i=!0),i},e.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},e.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},e.prototype.open=function(e,t){ve(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","true"),this.isOpen=!0,this.shouldFlip(e,t)&&(ve(this.element,this.classNames.flippedState),this.isFlipped=!0)},e.prototype.close=function(){ye(this.element,this.classNames.openState),this.element.setAttribute("aria-expanded","false"),this.removeActiveDescendant(),this.isOpen=!1,this.isFlipped&&(ye(this.element,this.classNames.flippedState),this.isFlipped=!1)},e.prototype.addFocusState=function(){ve(this.element,this.classNames.focusState)},e.prototype.removeFocusState=function(){ye(this.element,this.classNames.focusState)},e.prototype.enable=function(){ye(this.element,this.classNames.disabledState),this.element.removeAttribute("aria-disabled"),this.type===te&&this.element.setAttribute("tabindex","0"),this.isDisabled=!1},e.prototype.disable=function(){ve(this.element,this.classNames.disabledState),this.element.setAttribute("aria-disabled","true"),this.type===te&&this.element.setAttribute("tabindex","-1"),this.isDisabled=!0},e.prototype.wrap=function(e){var t=this.element,i=e.parentNode;i&&(e.nextSibling?i.insertBefore(t,e.nextSibling):i.appendChild(t)),t.appendChild(e)},e.prototype.unwrap=function(e){var t=this.element,i=t.parentNode;i&&(i.insertBefore(e,t),i.removeChild(t))},e.prototype.addLoadingState=function(){ve(this.element,this.classNames.loadingState),this.element.setAttribute("aria-busy","true"),this.isLoading=!0},e.prototype.removeLoadingState=function(){ye(this.element,this.classNames.loadingState),this.element.removeAttribute("aria-busy"),this.isLoading=!1},e}(),xe=function(){function e(e){var t=e.element,i=e.type,n=e.classNames,r=e.preventPaste;this.element=t,this.type=i,this.classNames=n,this.preventPaste=r,this.isFocussed=this.element.isEqualNode(document.activeElement),this.isDisabled=t.disabled,this._onPaste=this._onPaste.bind(this),this._onInput=this._onInput.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this)}return Object.defineProperty(e.prototype,"placeholder",{set:function(e){this.element.placeholder=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!1,configurable:!0}),e.prototype.addEventListeners=function(){var e=this.element;e.addEventListener("paste",this._onPaste),e.addEventListener("input",this._onInput,{passive:!0}),e.addEventListener("focus",this._onFocus,{passive:!0}),e.addEventListener("blur",this._onBlur,{passive:!0})},e.prototype.removeEventListeners=function(){var e=this.element;e.removeEventListener("input",this._onInput),e.removeEventListener("paste",this._onPaste),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur)},e.prototype.enable=function(){this.element.removeAttribute("disabled"),this.isDisabled=!1},e.prototype.disable=function(){this.element.setAttribute("disabled",""),this.isDisabled=!0},e.prototype.focus=function(){this.isFocussed||this.element.focus()},e.prototype.blur=function(){this.isFocussed&&this.element.blur()},e.prototype.clear=function(e){return void 0===e&&(e=!0),this.element.value="",e&&this.setWidth(),this},e.prototype.setWidth=function(){var e=this.element;e.style.minWidth="".concat(e.placeholder.length+1,"ch"),e.style.width="".concat(e.value.length+1,"ch")},e.prototype.setActiveDescendant=function(e){this.element.setAttribute("aria-activedescendant",e)},e.prototype.removeActiveDescendant=function(){this.element.removeAttribute("aria-activedescendant")},e.prototype._onInput=function(){this.type!==te&&this.setWidth()},e.prototype._onPaste=function(e){this.preventPaste&&e.preventDefault()},e.prototype._onFocus=function(){this.isFocussed=!0},e.prototype._onBlur=function(){this.isFocussed=!1},e}(),we=function(){function e(e){var t=e.element;this.element=t,this.scrollPos=this.element.scrollTop,this.height=this.element.offsetHeight}return e.prototype.prepend=function(e){var t=this.element.firstElementChild;t?this.element.insertBefore(e,t):this.element.append(e)},e.prototype.scrollToTop=function(){this.element.scrollTop=0},e.prototype.scrollToChildElement=function(e,t){var i=this;if(e){var n=this.element.offsetHeight,r=this.element.scrollTop+n,o=e.offsetHeight,a=e.offsetTop+o,s=t>0?this.element.scrollTop+a-r:e.offsetTop;requestAnimationFrame((function(){i._animateScroll(s,t)}))}},e.prototype._scrollDown=function(e,t,i){var n=(i-e)/t,r=n>1?n:1;this.element.scrollTop=e+r},e.prototype._scrollUp=function(e,t,i){var n=(e-i)/t,r=n>1?n:1;this.element.scrollTop=e-r},e.prototype._animateScroll=function(e,t){var i=this,n=this.element.scrollTop,r=!1;t>0?(this._scrollDown(n,4,e),n<e&&(r=!0)):(this._scrollUp(n,4,e),n>e&&(r=!0)),r&&requestAnimationFrame((function(){i._animateScroll(e,t)}))},e}(),Ce=function(){function e(e){var t=e.element,i=e.classNames;this.element=t,this.classNames=i,this.isDisabled=!1}return Object.defineProperty(e.prototype,"isActive",{get:function(){return"active"===this.element.dataset.choice},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dir",{get:function(){return this.element.dir},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.setAttribute("value",e),this.element.value=e},enumerable:!1,configurable:!0}),e.prototype.conceal=function(){var e=this.element;ve(e,this.classNames.input),e.hidden=!0,e.tabIndex=-1;var t=e.getAttribute("style");t&&e.setAttribute("data-choice-orig-style",t),e.setAttribute("data-choice","active")},e.prototype.reveal=function(){var e=this.element;ye(e,this.classNames.input),e.hidden=!1,e.removeAttribute("tabindex");var t=e.getAttribute("data-choice-orig-style");t?(e.removeAttribute("data-choice-orig-style"),e.setAttribute("style",t)):e.removeAttribute("style"),e.removeAttribute("data-choice")},e.prototype.enable=function(){this.element.removeAttribute("disabled"),this.element.disabled=!1,this.isDisabled=!1},e.prototype.disable=function(){this.element.setAttribute("disabled",""),this.element.disabled=!0,this.isDisabled=!0},e.prototype.triggerEvent=function(e,t){!function(e,t,i){void 0===i&&(i=null);var n=new CustomEvent(t,{detail:i,bubbles:!0,cancelable:!0});e.dispatchEvent(n)}(this.element,e,t||{})},e}(),Ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return P(t,e),t}(Ce),Se=function(e,t){return void 0===t&&(t=!0),void 0===e?t:!!e},Le=function(e){if("string"==typeof e&&(e=e.split(" ").filter((function(e){return e.length}))),Array.isArray(e)&&e.length)return e},Ie=function(e,t){if("string"==typeof e)return Ie({value:e,label:e},!1);var i=e;if("choices"in i){if(!t)throw new TypeError("optGroup is not allowed");var n=i,r=n.choices.map((function(e){return Ie(e,!1)}));return{id:0,label:he(n.label)||n.value,active:!!r.length,disabled:!!n.disabled,choices:r}}var o=i;return{id:0,group:null,score:0,rank:0,value:o.value,label:o.label||o.value,active:Se(o.active),selected:Se(o.selected,!1),disabled:Se(o.disabled,!1),placeholder:Se(o.placeholder,!1),highlighted:!1,labelClass:Le(o.labelClass),labelDescription:o.labelDescription,customProperties:o.customProperties}},Me=function(e){return"SELECT"===e.tagName},Pe=function(e){function t(t){var i=t.element,n=t.classNames,r=t.template,o=t.extractPlaceholder,a=e.call(this,{element:i,classNames:n})||this;return a.template=r,a.extractPlaceholder=o,a}return P(t,e),Object.defineProperty(t.prototype,"placeholderOption",{get:function(){return this.element.querySelector('option[value=""]')||this.element.querySelector("option[placeholder]")},enumerable:!1,configurable:!0}),t.prototype.addOptions=function(e){var t=this,i=document.createDocumentFragment();e.forEach((function(e){var n=e;if(!n.element){var r=t.template(n);i.appendChild(r),n.element=r}})),this.element.appendChild(i)},t.prototype.optionsAsChoices=function(){var e=this,t=[];return this.element.querySelectorAll(":scope > option, :scope > optgroup").forEach((function(i){!function(e){return"OPTION"===e.tagName}(i)?function(e){return"OPTGROUP"===e.tagName}(i)&&t.push(e._optgroupToChoice(i)):t.push(e._optionToChoice(i))})),t},t.prototype._optionToChoice=function(e){return!e.hasAttribute("value")&&e.hasAttribute("placeholder")&&(e.setAttribute("value",""),e.value=""),{id:0,group:null,score:0,rank:0,value:e.value,label:e.innerHTML,element:e,active:!0,selected:this.extractPlaceholder?e.selected:e.hasAttribute("selected"),disabled:e.disabled,highlighted:!1,placeholder:this.extractPlaceholder&&(!e.value||e.hasAttribute("placeholder")),labelClass:void 0!==e.dataset.labelClass?Le(e.dataset.labelClass):void 0,labelDescription:void 0!==e.dataset.labelDescription?e.dataset.labelDescription:void 0,customProperties:be(e.dataset.customProperties)}},t.prototype._optgroupToChoice=function(e){var t=this,i=e.querySelectorAll("option"),n=Array.from(i).map((function(e){return t._optionToChoice(e)}));return{id:0,label:e.label||"",element:e,active:!!n.length,disabled:e.disabled,choices:n}},t}(Ce),Te={items:[],choices:[],silent:!1,renderChoiceLimit:-1,maxItemCount:-1,closeDropdownOnSelect:"auto",singleModeForMultiSelect:!1,addChoices:!1,addItems:!0,addItemFilter:function(e){return!!e&&""!==e},removeItems:!0,removeItemButton:!1,removeItemButtonAlignLeft:!1,editItems:!1,allowHTML:!1,allowHtmlUserInput:!1,duplicateItemsAllowed:!0,delimiter:",",paste:!0,searchEnabled:!0,searchChoices:!0,searchFloor:1,searchResultLimit:4,searchFields:["label","value"],position:"auto",resetScrollPosition:!0,shouldSort:!0,shouldSortItems:!1,sorter:function(e,t){var i=e.value,n=e.label,r=void 0===n?i:n,o=t.value,a=t.label,s=void 0===a?o:a;return he(r).localeCompare(he(s),[],{sensitivity:"base",ignorePunctuation:!0,numeric:!0})},shadowRoot:null,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,prependValue:null,appendValue:null,renderSelectedChoices:"auto",loadingText:"Loading...",noResultsText:"No results found",noChoicesText:"No choices to choose from",itemSelectText:"Press to select",uniqueItemText:"Only unique values can be added",customAddItemText:"Only values matching specific conditions can be added",addItemText:function(e){return'Press Enter to add <b>"'.concat(e,'"</b>')},removeItemIconText:function(){return"Remove item"},removeItemLabelText:function(e){return"Remove item: ".concat(e)},maxItemText:function(e){return"Only ".concat(e," values can be added")},valueComparer:function(e,t){return e===t},fuseOptions:{includeScore:!0},labelId:"",callbackOnInit:null,callbackOnCreateTemplates:null,classNames:{containerOuter:["choices"],containerInner:["choices__inner"],input:["choices__input"],inputCloned:["choices__input--cloned"],list:["choices__list"],listItems:["choices__list--multiple"],listSingle:["choices__list--single"],listDropdown:["choices__list--dropdown"],item:["choices__item"],itemSelectable:["choices__item--selectable"],itemDisabled:["choices__item--disabled"],itemChoice:["choices__item--choice"],description:["choices__description"],placeholder:["choices__placeholder"],group:["choices__group"],groupHeading:["choices__heading"],button:["choices__button"],activeState:["is-active"],focusState:["is-focused"],openState:["is-open"],disabledState:["is-disabled"],highlightedState:["is-highlighted"],selectedState:["is-selected"],flippedState:["is-flipped"],loadingState:["is-loading"],notice:["choices__notice"],addChoice:["choices__item--selectable","add-choice"],noResults:["has-no-results"],noChoices:["has-no-choices"]},appendGroupInSearch:!1},Ae=function(e){var t=e.itemEl;t&&(t.remove(),e.itemEl=void 0)};var Oe={groups:function(e,t){var i=e,n=!0;switch(t.type){case q:i.push(t.group);break;case R:i=[];break;default:n=!1}return{state:i,update:n}},items:function(e,t,i){var n=e,r=!0;switch(t.type){case B:t.item.selected=!0,(o=t.item.element)&&(o.selected=!0,o.setAttribute("selected","")),n.push(t.item);break;case H:var o;if(t.item.selected=!1,o=t.item.element){o.selected=!1,o.removeAttribute("selected");var a=o.parentElement;a&&Me(a)&&a.type===te&&(a.value="")}Ae(t.item),n=n.filter((function(e){return e.id!==t.item.id}));break;case F:Ae(t.choice),n=n.filter((function(e){return e.id!==t.choice.id}));break;case V:var s=t.highlighted,c=n.find((function(e){return e.id===t.item.id}));c&&c.highlighted!==s&&(c.highlighted=s,i&&function(e,t,i){var n=e.itemEl;n&&(ye(n,i),ve(n,t))}(c,s?i.classNames.highlightedState:i.classNames.selectedState,s?i.classNames.selectedState:i.classNames.highlightedState));break;default:r=!1}return{state:n,update:r}},choices:function(e,t,i){var n=e,r=!0;switch(t.type){case N:n.push(t.choice);break;case F:t.choice.choiceEl=void 0,t.choice.group&&(t.choice.group.choices=t.choice.group.choices.filter((function(e){return e.id!==t.choice.id}))),n=n.filter((function(e){return e.id!==t.choice.id}));break;case B:case H:t.item.choiceEl=void 0;break;case j:var o=[];t.results.forEach((function(e){o[e.item.id]=e})),n.forEach((function(e){var t=o[e.id];void 0!==t?(e.score=t.score,e.rank=t.rank,e.active=!0):(e.score=0,e.rank=0,e.active=!1),i&&i.appendGroupInSearch&&(e.choiceEl=void 0)}));break;case D:n.forEach((function(e){e.active=t.active,i&&i.appendGroupInSearch&&(e.choiceEl=void 0)}));break;case R:n=[];break;default:r=!1}return{state:n,update:r}}},Ne=function(){function e(e){this._state=this.defaultState,this._listeners=[],this._txn=0,this._context=e}return Object.defineProperty(e.prototype,"defaultState",{get:function(){return{groups:[],items:[],choices:[]}},enumerable:!1,configurable:!0}),e.prototype.changeSet=function(e){return{groups:e,items:e,choices:e}},e.prototype.reset=function(){this._state=this.defaultState;var e=this.changeSet(!0);this._txn?this._changeSet=e:this._listeners.forEach((function(t){return t(e)}))},e.prototype.subscribe=function(e){return this._listeners.push(e),this},e.prototype.dispatch=function(e){var t=this,i=this._state,n=!1,r=this._changeSet||this.changeSet(!1);Object.keys(Oe).forEach((function(o){var a=Oe[o](i[o],e,t._context);a.update&&(n=!0,r[o]=!0,i[o]=a.state)})),n&&(this._txn?this._changeSet=r:this._listeners.forEach((function(e){return e(r)})))},e.prototype.withTxn=function(e){this._txn++;try{e()}finally{if(this._txn=Math.max(0,this._txn-1),!this._txn){var t=this._changeSet;t&&(this._changeSet=void 0,this._listeners.forEach((function(e){return e(t)})))}}},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this.state.items},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightedActiveItems",{get:function(){return this.items.filter((function(e){return!e.disabled&&e.active&&e.highlighted}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"choices",{get:function(){return this.state.choices},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeChoices",{get:function(){return this.choices.filter((function(e){return e.active}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"searchableChoices",{get:function(){return this.choices.filter((function(e){return!e.disabled&&!e.placeholder}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"groups",{get:function(){return this.state.groups},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeGroups",{get:function(){var e=this;return this.state.groups.filter((function(t){var i=t.active&&!t.disabled,n=e.state.choices.some((function(e){return e.active&&!e.disabled}));return i&&n}),[])},enumerable:!1,configurable:!0}),e.prototype.inTxn=function(){return this._txn>0},e.prototype.getChoiceById=function(e){return this.activeChoices.find((function(t){return t.id===e}))},e.prototype.getGroupById=function(e){return this.groups.find((function(t){return t.id===e}))},e}(),Fe="no-choices",je="no-results",De="add-choice",Re="";function qe(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=b(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==b(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Be(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function He(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(i),!0).forEach((function(t){qe(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Be(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Ve(e){return Array.isArray?Array.isArray(e):"[object Array]"===Ye(e)}function ze(e){return"string"==typeof e}function Ke(e){return"number"==typeof e}function Ge(e){return!0===e||!1===e||function(e){return $e(e)&&null!==e}(e)&&"[object Boolean]"==Ye(e)}function $e(e){return"object"===b(e)}function We(e){return null!=e}function Ue(e){return!e.trim().length}function Ye(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}var Je=Object.prototype.hasOwnProperty,Ze=function(){return a((function e(t){var i=this;r(this,e),this._keys=[],this._keyMap={};var n=0;t.forEach((function(e){var t=Qe(e);i._keys.push(t),i._keyMap[t.id]=t,n+=t.weight})),this._keys.forEach((function(e){e.weight/=n}))}),[{key:"get",value:function(e){return this._keyMap[e]}},{key:"keys",value:function(){return this._keys}},{key:"toJSON",value:function(){return JSON.stringify(this._keys)}}])}();function Qe(e){var t=null,i=null,n=null,r=1,o=null;if(ze(e)||Ve(e))n=e,t=Xe(e),i=et(e);else{if(!Je.call(e,"name"))throw new Error(function(e){return"Missing ".concat(e," property in key")}("name"));var a=e.name;if(n=a,Je.call(e,"weight")&&(r=e.weight)<=0)throw new Error(function(e){return"Property 'weight' in key '".concat(e,"' must be a positive integer")}(a));t=Xe(a),i=et(a),o=e.getFn}return{path:t,id:i,weight:r,src:n,getFn:o}}function Xe(e){return Ve(e)?e:e.split(".")}function et(e){return Ve(e)?e.join("."):e}var tt={useExtendedSearch:!1,getFn:function(e,t){var i=[],n=!1,r=function(e,t,o){if(We(e))if(t[o]){var a=e[t[o]];if(!We(a))return;if(o===t.length-1&&(ze(a)||Ke(a)||Ge(a)))i.push(function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)}(a));else if(Ve(a)){n=!0;for(var s=0,c=a.length;s<c;s+=1)r(a[s],t,o+1)}else t.length&&r(a,t,o+1)}else i.push(e)};return r(e,ze(t)?t.split("."):t,0),n?i:i[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},it=He(He(He(He({},{isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:function(e,t){return e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1}}),{includeMatches:!1,findAllMatches:!1,minMatchCharLength:1}),{location:0,threshold:.6,distance:100}),tt),nt=/[^ ]+/g;var rt=function(){return a((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.getFn,n=void 0===i?it.getFn:i,o=t.fieldNormWeight,a=void 0===o?it.fieldNormWeight:o;r(this,e),this.norm=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=new Map,n=Math.pow(10,t);return{get:function(t){var r=t.match(nt).length;if(i.has(r))return i.get(r);var o=1/Math.pow(r,.5*e),a=parseFloat(Math.round(o*n)/n);return i.set(r,a),a},clear:function(){i.clear()}}}(a,3),this.getFn=n,this.isCreated=!1,this.setIndexRecords()}),[{key:"setSources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.docs=e}},{key:"setIndexRecords",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.records=e}},{key:"setKeys",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.keys=t,this._keysMap={},t.forEach((function(t,i){e._keysMap[t.id]=i}))}},{key:"create",value:function(){var e=this;!this.isCreated&&this.docs.length&&(this.isCreated=!0,ze(this.docs[0])?this.docs.forEach((function(t,i){e._addString(t,i)})):this.docs.forEach((function(t,i){e._addObject(t,i)})),this.norm.clear())}},{key:"add",value:function(e){var t=this.size();ze(e)?this._addString(e,t):this._addObject(e,t)}},{key:"removeAt",value:function(e){this.records.splice(e,1);for(var t=e,i=this.size();t<i;t+=1)this.records[t].i-=1}},{key:"getValueForItemAtKeyId",value:function(e,t){return e[this._keysMap[t]]}},{key:"size",value:function(){return this.records.length}},{key:"_addString",value:function(e,t){if(We(e)&&!Ue(e)){var i={v:e,i:t,n:this.norm.get(e)};this.records.push(i)}}},{key:"_addObject",value:function(e,t){var i=this,n={i:t,$:{}};this.keys.forEach((function(t,r){var o=t.getFn?t.getFn(e):i.getFn(e,t.path);if(We(o))if(Ve(o)){for(var a=[],s=[{nestedArrIndex:-1,value:o}];s.length;){var c=s.pop(),l=c.nestedArrIndex,u=c.value;if(We(u))if(ze(u)&&!Ue(u)){var h={v:u,i:l,n:i.norm.get(u)};a.push(h)}else Ve(u)&&u.forEach((function(e,t){s.push({nestedArrIndex:t,value:e})}))}n.$[r]=a}else if(ze(o)&&!Ue(o)){var d={v:o,n:i.norm.get(o)};n.$[r]=d}})),this.records.push(n)}},{key:"toJSON",value:function(){return{keys:this.keys,records:this.records}}}])}();function ot(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.getFn,r=void 0===n?it.getFn:n,o=i.fieldNormWeight,a=void 0===o?it.fieldNormWeight:o,s=new rt({getFn:r,fieldNormWeight:a});return s.setKeys(e.map(Qe)),s.setSources(t),s.create(),s}function at(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.errors,n=void 0===i?0:i,r=t.currentLocation,o=void 0===r?0:r,a=t.expectedLocation,s=void 0===a?0:a,c=t.distance,l=void 0===c?it.distance:c,u=t.ignoreLocation,h=void 0===u?it.ignoreLocation:u,d=n/e.length;if(h)return d;var p=Math.abs(s-o);return l?d+p/l:p?1:d}var st=32;function ct(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=n.location,o=void 0===r?it.location:r,a=n.distance,s=void 0===a?it.distance:a,c=n.threshold,l=void 0===c?it.threshold:c,u=n.findAllMatches,h=void 0===u?it.findAllMatches:u,d=n.minMatchCharLength,p=void 0===d?it.minMatchCharLength:d,f=n.includeMatches,g=void 0===f?it.includeMatches:f,m=n.ignoreLocation,v=void 0===m?it.ignoreLocation:m;if(t.length>st)throw new Error("Pattern length exceeds max of ".concat(st,"."));for(var y,b=t.length,_=e.length,k=Math.max(0,Math.min(o,_)),x=l,w=k,C=p>1||g,E=C?Array(_):[];(y=e.indexOf(t,w))>-1;){var S=at(t,{currentLocation:y,expectedLocation:k,distance:s,ignoreLocation:v});if(x=Math.min(S,x),w=y+b,C)for(var L=0;L<b;)E[y+L]=1,L+=1}w=-1;for(var I=[],M=1,P=b+_,T=1<<b-1,A=0;A<b;A+=1){for(var O=0,N=P;O<N;){at(t,{errors:A,currentLocation:k+N,expectedLocation:k,distance:s,ignoreLocation:v})<=x?O=N:P=N,N=Math.floor((P-O)/2+O)}P=N;var F=Math.max(1,k-N+1),j=h?_:Math.min(k+N,_)+b,D=Array(j+2);D[j+1]=(1<<A)-1;for(var R=j;R>=F;R-=1){var q=R-1,B=i[e.charAt(q)];if(C&&(E[q]=+!!B),D[R]=(D[R+1]<<1|1)&B,A&&(D[R]|=(I[R+1]|I[R])<<1|1|I[R+1]),D[R]&T&&(M=at(t,{errors:A,currentLocation:q,expectedLocation:k,distance:s,ignoreLocation:v}))<=x){if(x=M,(w=q)<=k)break;F=Math.max(1,2*k-w)}}if(at(t,{errors:A+1,currentLocation:k,expectedLocation:k,distance:s,ignoreLocation:v})>x)break;I=D}var H={isMatch:w>=0,score:Math.max(.001,M)};if(C){var V=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:it.minMatchCharLength,i=[],n=-1,r=-1,o=0,a=e.length;o<a;o+=1){var s=e[o];s&&-1===n?n=o:s||-1===n||((r=o-1)-n+1>=t&&i.push([n,r]),n=-1)}return e[o-1]&&o-n>=t&&i.push([n,o-1]),i}(E,p);V.length?g&&(H.indices=V):H.isMatch=!1}return H}function lt(e){for(var t={},i=0,n=e.length;i<n;i+=1){var r=e.charAt(i);t[r]=(t[r]||0)|1<<n-i-1}return t}var ut=function(){return a((function e(t){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.location,a=void 0===o?it.location:o,s=n.threshold,c=void 0===s?it.threshold:s,l=n.distance,u=void 0===l?it.distance:l,h=n.includeMatches,d=void 0===h?it.includeMatches:h,p=n.findAllMatches,f=void 0===p?it.findAllMatches:p,g=n.minMatchCharLength,m=void 0===g?it.minMatchCharLength:g,v=n.isCaseSensitive,y=void 0===v?it.isCaseSensitive:v,b=n.ignoreLocation,_=void 0===b?it.ignoreLocation:b;if(r(this,e),this.options={location:a,threshold:c,distance:u,includeMatches:d,findAllMatches:f,minMatchCharLength:m,isCaseSensitive:y,ignoreLocation:_},this.pattern=y?t:t.toLowerCase(),this.chunks=[],this.pattern.length){var k=function(e,t){i.chunks.push({pattern:e,alphabet:lt(e),startIndex:t})},x=this.pattern.length;if(x>st){for(var w=0,C=x%st,E=x-C;w<E;)k(this.pattern.substr(w,st),w),w+=st;if(C){var S=x-st;k(this.pattern.substr(S),S)}}else k(this.pattern,0)}}),[{key:"searchIn",value:function(e){var t=this.options,i=t.isCaseSensitive,n=t.includeMatches;if(i||(e=e.toLowerCase()),this.pattern===e){var r={isMatch:!0,score:0};return n&&(r.indices=[[0,e.length-1]]),r}var o=this.options,a=o.location,s=o.distance,c=o.threshold,l=o.findAllMatches,u=o.minMatchCharLength,h=o.ignoreLocation,d=[],p=0,f=!1;this.chunks.forEach((function(t){var i=t.pattern,r=t.alphabet,o=t.startIndex,g=ct(e,i,r,{location:a+o,distance:s,threshold:c,findAllMatches:l,minMatchCharLength:u,includeMatches:n,ignoreLocation:h}),m=g.isMatch,y=g.score,b=g.indices;m&&(f=!0),p+=y,m&&b&&(d=[].concat(v(d),v(b)))}));var g={isMatch:f,score:f?p/this.chunks.length:1};return f&&n&&(g.indices=d),g}}])}(),ht=function(){return a((function e(t){r(this,e),this.pattern=t}),[{key:"search",value:function(){}}],[{key:"isMultiMatch",value:function(e){return dt(e,this.multiRegex)}},{key:"isSingleMatch",value:function(e){return dt(e,this.singleRegex)}}])}();function dt(e,t){var i=e.match(t);return i?i[1]:null}var pt=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,ht),a(e,[{key:"search",value:function(e){var t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}],[{key:"type",get:function(){return"exact"}},{key:"multiRegex",get:function(){return/^="(.*)"$/}},{key:"singleRegex",get:function(){return/^=(.*)$/}}])}(),ft=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,ht),a(e,[{key:"search",value:function(e){var t=-1===e.indexOf(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-exact"}},{key:"multiRegex",get:function(){return/^!"(.*)"$/}},{key:"singleRegex",get:function(){return/^!(.*)$/}}])}(),gt=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,ht),a(e,[{key:"search",value:function(e){var t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}],[{key:"type",get:function(){return"prefix-exact"}},{key:"multiRegex",get:function(){return/^\^"(.*)"$/}},{key:"singleRegex",get:function(){return/^\^(.*)$/}}])}(),mt=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,ht),a(e,[{key:"search",value:function(e){var t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-prefix-exact"}},{key:"multiRegex",get:function(){return/^!\^"(.*)"$/}},{key:"singleRegex",get:function(){return/^!\^(.*)$/}}])}(),vt=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,ht),a(e,[{key:"search",value:function(e){var t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}],[{key:"type",get:function(){return"suffix-exact"}},{key:"multiRegex",get:function(){return/^"(.*)"\$$/}},{key:"singleRegex",get:function(){return/^(.*)\$$/}}])}(),yt=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,ht),a(e,[{key:"search",value:function(e){var t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-suffix-exact"}},{key:"multiRegex",get:function(){return/^!"(.*)"\$$/}},{key:"singleRegex",get:function(){return/^!(.*)\$$/}}])}(),bt=function(){function e(t){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.location,s=void 0===a?it.location:a,c=o.threshold,l=void 0===c?it.threshold:c,u=o.distance,h=void 0===u?it.distance:u,d=o.includeMatches,p=void 0===d?it.includeMatches:d,f=o.findAllMatches,g=void 0===f?it.findAllMatches:f,m=o.minMatchCharLength,v=void 0===m?it.minMatchCharLength:m,y=o.isCaseSensitive,b=void 0===y?it.isCaseSensitive:y,_=o.ignoreLocation,k=void 0===_?it.ignoreLocation:_;return r(this,e),(i=n(this,e,[t]))._bitapSearch=new ut(t,{location:s,threshold:l,distance:h,includeMatches:p,findAllMatches:g,minMatchCharLength:v,isCaseSensitive:b,ignoreLocation:k}),i}return u(e,ht),a(e,[{key:"search",value:function(e){return this._bitapSearch.searchIn(e)}}],[{key:"type",get:function(){return"fuzzy"}},{key:"multiRegex",get:function(){return/^"(.*)"$/}},{key:"singleRegex",get:function(){return/^(.*)$/}}])}(),_t=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,ht),a(e,[{key:"search",value:function(e){for(var t,i=0,n=[],r=this.pattern.length;(t=e.indexOf(this.pattern,i))>-1;)i=t+r,n.push([t,i-1]);var o=!!n.length;return{isMatch:o,score:o?0:1,indices:n}}}],[{key:"type",get:function(){return"include"}},{key:"multiRegex",get:function(){return/^'"(.*)"$/}},{key:"singleRegex",get:function(){return/^'(.*)$/}}])}(),kt=[pt,_t,gt,mt,yt,vt,ft,bt],xt=kt.length,wt=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;var Ct=new Set([bt.type,_t.type]),Et=function(){return a((function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.isCaseSensitive,o=void 0===n?it.isCaseSensitive:n,a=i.includeMatches,s=void 0===a?it.includeMatches:a,c=i.minMatchCharLength,l=void 0===c?it.minMatchCharLength:c,u=i.ignoreLocation,h=void 0===u?it.ignoreLocation:u,d=i.findAllMatches,p=void 0===d?it.findAllMatches:d,f=i.location,g=void 0===f?it.location:f,m=i.threshold,v=void 0===m?it.threshold:m,y=i.distance,b=void 0===y?it.distance:y;r(this,e),this.query=null,this.options={isCaseSensitive:o,includeMatches:s,minMatchCharLength:l,findAllMatches:p,ignoreLocation:h,location:g,threshold:v,distance:b},this.pattern=o?t:t.toLowerCase(),this.query=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.split("|").map((function(e){for(var i=e.trim().split(wt).filter((function(e){return e&&!!e.trim()})),n=[],r=0,o=i.length;r<o;r+=1){for(var a=i[r],s=!1,c=-1;!s&&++c<xt;){var l=kt[c],u=l.isMultiMatch(a);u&&(n.push(new l(u,t)),s=!0)}if(!s)for(c=-1;++c<xt;){var h=kt[c],d=h.isSingleMatch(a);if(d){n.push(new h(d,t));break}}}return n}))}(this.pattern,this.options)}),[{key:"searchIn",value:function(e){var t=this.query;if(!t)return{isMatch:!1,score:1};var i=this.options,n=i.includeMatches;e=i.isCaseSensitive?e:e.toLowerCase();for(var r=0,o=[],a=0,s=0,c=t.length;s<c;s+=1){var l=t[s];o.length=0,r=0;for(var u=0,h=l.length;u<h;u+=1){var d=l[u],p=d.search(e),f=p.isMatch,g=p.indices,m=p.score;if(!f){a=0,r=0,o.length=0;break}if(r+=1,a+=m,n){var y=d.constructor.type;Ct.has(y)?o=[].concat(v(o),v(g)):o.push(g)}}if(r){var b={isMatch:!0,score:a/r};return n&&(b.indices=o),b}}return{isMatch:!1,score:1}}}],[{key:"condition",value:function(e,t){return t.useExtendedSearch}}])}(),St=[];function Lt(e,t){for(var i=0,n=St.length;i<n;i+=1){var r=St[i];if(r.condition(e,t))return new r(e,t)}return new ut(e,t)}var It="$and",Mt="$or",Pt="$path",Tt="$val",At=function(e){return!(!e[It]&&!e[Mt])},Ot=function(e){return c({},It,Object.keys(e).map((function(t){return c({},t,e[t])})))};function Nt(e,t){var i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).auto,n=void 0===i||i,r=function(e){var i=Object.keys(e),o=function(e){return!!e[Pt]}(e);if(!o&&i.length>1&&!At(e))return r(Ot(e));if(function(e){return!Ve(e)&&$e(e)&&!At(e)}(e)){var a=o?e[Pt]:i[0],s=o?e[Tt]:e[a];if(!ze(s))throw new Error(function(e){return"Invalid value for key ".concat(e)}(a));var c={keyId:et(a),pattern:s};return n&&(c.searcher=Lt(s,t)),c}var l={children:[],operator:i[0]};return i.forEach((function(t){var i=e[t];Ve(i)&&i.forEach((function(e){l.children.push(r(e))}))})),l};return At(e)||(e=Ot(e)),r(e)}function Ft(e,t){var i=e.matches;t.matches=[],We(i)&&i.forEach((function(e){if(We(e.indices)&&e.indices.length){var i={indices:e.indices,value:e.value};e.key&&(i.key=e.key.src),e.idx>-1&&(i.refIndex=e.idx),t.matches.push(i)}}))}function jt(e,t){t.score=e.score}var Dt=function(){return a((function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;r(this,e),this.options=He(He({},it),i),this.options.useExtendedSearch,this._keyStore=new Ze(this.options.keys),this.setCollection(t,n)}),[{key:"setCollection",value:function(e,t){if(this._docs=e,t&&!(t instanceof rt))throw new Error("Incorrect 'index' type");this._myIndex=t||ot(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}},{key:"add",value:function(e){We(e)&&(this._docs.push(e),this._myIndex.add(e))}},{key:"remove",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return!1},t=[],i=0,n=this._docs.length;i<n;i+=1){var r=this._docs[i];e(r,i)&&(this.removeAt(i),i-=1,n-=1,t.push(r))}return t}},{key:"removeAt",value:function(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}},{key:"getIndex",value:function(){return this._myIndex}},{key:"search",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).limit,i=void 0===t?-1:t,n=this.options,r=n.includeMatches,o=n.includeScore,a=n.shouldSort,s=n.sortFn,c=n.ignoreFieldNorm,l=ze(e)?ze(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(e,t){var i=t.ignoreFieldNorm,n=void 0===i?it.ignoreFieldNorm:i;e.forEach((function(e){var t=1;e.matches.forEach((function(e){var i=e.key,r=e.norm,o=e.score,a=i?i.weight:null;t*=Math.pow(0===o&&a?Number.EPSILON:o,(a||1)*(n?1:r))})),e.score=t}))}(l,{ignoreFieldNorm:c}),a&&l.sort(s),Ke(i)&&i>-1&&(l=l.slice(0,i)),function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.includeMatches,r=void 0===n?it.includeMatches:n,o=i.includeScore,a=void 0===o?it.includeScore:o,s=[];return r&&s.push(Ft),a&&s.push(jt),e.map((function(e){var i=e.idx,n={item:t[i],refIndex:i};return s.length&&s.forEach((function(t){t(e,n)})),n}))}(l,this._docs,{includeMatches:r,includeScore:o})}},{key:"_searchStringList",value:function(e){var t=Lt(e,this.options),i=this._myIndex.records,n=[];return i.forEach((function(e){var i=e.v,r=e.i,o=e.n;if(We(i)){var a=t.searchIn(i),s=a.isMatch,c=a.score,l=a.indices;s&&n.push({item:i,idx:r,matches:[{score:c,value:i,norm:o,indices:l}]})}})),n}},{key:"_searchLogical",value:function(e){var t=this,i=Nt(e,this.options),n=function(e,i,r){if(!e.children){var o=e.keyId,a=e.searcher,s=t._findMatches({key:t._keyStore.get(o),value:t._myIndex.getValueForItemAtKeyId(i,o),searcher:a});return s&&s.length?[{idx:r,item:i,matches:s}]:[]}for(var c=[],l=0,u=e.children.length;l<u;l+=1){var h=e.children[l],d=n(h,i,r);if(d.length)c.push.apply(c,v(d));else if(e.operator===It)return[]}return c},r=this._myIndex.records,o={},a=[];return r.forEach((function(e){var t=e.$,r=e.i;if(We(t)){var s=n(i,t,r);s.length&&(o[r]||(o[r]={idx:r,item:t,matches:[]},a.push(o[r])),s.forEach((function(e){var t,i=e.matches;(t=o[r].matches).push.apply(t,v(i))})))}})),a}},{key:"_searchObjectList",value:function(e){var t=this,i=Lt(e,this.options),n=this._myIndex,r=n.keys,o=n.records,a=[];return o.forEach((function(e){var n=e.$,o=e.i;if(We(n)){var s=[];r.forEach((function(e,r){s.push.apply(s,v(t._findMatches({key:e,value:n[r],searcher:i})))})),s.length&&a.push({idx:o,item:n,matches:s})}})),a}},{key:"_findMatches",value:function(e){var t=e.key,i=e.value,n=e.searcher;if(!We(i))return[];var r=[];if(Ve(i))i.forEach((function(e){var i=e.v,o=e.i,a=e.n;if(We(i)){var s=n.searchIn(i),c=s.isMatch,l=s.score,u=s.indices;c&&r.push({score:l,key:t,value:i,idx:o,norm:a,indices:u})}}));else{var o=i.v,a=i.n,s=n.searchIn(o),c=s.isMatch,l=s.score,u=s.indices;c&&r.push({score:l,key:t,value:o,norm:a,indices:u})}return r}}])}();Dt.version="7.0.0",Dt.createIndex=ot,Dt.parseIndex=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.getFn,n=void 0===i?it.getFn:i,r=t.fieldNormWeight,o=void 0===r?it.fieldNormWeight:r,a=e.keys,s=e.records,c=new rt({getFn:n,fieldNormWeight:o});return c.setKeys(a),c.setIndexRecords(s),c},Dt.config=it,Dt.parseQuery=Nt,function(){St.push.apply(St,arguments)}(Et);var Rt=function(){function e(e){this._haystack=[],this._fuseOptions=T(T({},e.fuseOptions),{keys:A([],e.searchFields),includeMatches:!0})}return e.prototype.index=function(e){this._haystack=e,this._fuse&&this._fuse.setCollection(e)},e.prototype.reset=function(){this._haystack=[],this._fuse=void 0},e.prototype.isEmptyIndex=function(){return!this._haystack.length},e.prototype.search=function(e){return this._fuse||(this._fuse=new Dt(this._haystack,this._fuseOptions)),this._fuse.search(e).map((function(e,t){return{item:e.item,score:e.score||0,rank:t+1}}))},e}();var qt=function(e,t,i){var n=e.dataset,r=t.customProperties,o=t.labelClass,a=t.labelDescription;o&&(n.labelClass=ge(o).join(" ")),a&&(n.labelDescription=a),i&&r&&("string"==typeof r?n.customProperties=r:"object"!==b(r)||function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(r)||(n.customProperties=JSON.stringify(r)))},Bt=function(e,t,i){var n=t&&e.querySelector("label[for='".concat(t,"']")),r=n&&n.innerText;r&&i.setAttribute("aria-label",r)},Ht={containerOuter:function(e,t,i,n,r,o,a){var s=e.classNames.containerOuter,c=document.createElement("div");return ve(c,s),c.dataset.type=o,t&&(c.dir=t),n&&(c.tabIndex=0),i&&(c.setAttribute("role",r?"combobox":"listbox"),r?c.setAttribute("aria-autocomplete","list"):a||Bt(this._docRoot,this.passedElement.element.id,c),c.setAttribute("aria-haspopup","true"),c.setAttribute("aria-expanded","false")),a&&c.setAttribute("aria-labelledby",a),c},containerInner:function(e){var t=e.classNames.containerInner,i=document.createElement("div");return ve(i,t),i},itemList:function(e,t){var i=e.searchEnabled,n=e.classNames,r=n.list,o=n.listSingle,a=n.listItems,s=document.createElement("div");return ve(s,r),ve(s,t?o:a),this._isSelectElement&&i&&s.setAttribute("role","listbox"),s},placeholder:function(e,t){var i=e.allowHTML,n=e.classNames.placeholder,r=document.createElement("div");return ve(r,n),pe(r,i,t),r},item:function(e,t,i){var n=e.allowHTML,r=e.removeItemButtonAlignLeft,o=e.removeItemIconText,a=e.removeItemLabelText,s=e.classNames,c=s.item,l=s.button,u=s.highlightedState,h=s.itemSelectable,d=s.placeholder,p=he(t.value),f=document.createElement("div");if(ve(f,c),t.labelClass){var g=document.createElement("span");pe(g,n,t.label),ve(g,t.labelClass),f.appendChild(g)}else pe(f,n,t.label);if(f.dataset.item="",f.dataset.id=t.id,f.dataset.value=p,qt(f,t,!0),(t.disabled||this.containerOuter.isDisabled)&&f.setAttribute("aria-disabled","true"),this._isSelectElement&&(f.setAttribute("aria-selected","true"),f.setAttribute("role","option")),t.placeholder&&(ve(f,d),f.dataset.placeholder=""),ve(f,t.highlighted?u:h),i){t.disabled&&ye(f,h),f.dataset.deletable="";var m=document.createElement("button");m.type="button",ve(m,l),pe(m,!0,le(o,t.value));var v=le(a,t.value);v&&m.setAttribute("aria-label",v),m.dataset.button="",r?f.insertAdjacentElement("afterbegin",m):f.appendChild(m)}return f},choiceList:function(e,t){var i=e.classNames.list,n=document.createElement("div");return ve(n,i),t||n.setAttribute("aria-multiselectable","true"),n.setAttribute("role","listbox"),n},choiceGroup:function(e,t){var i=e.allowHTML,n=e.classNames,r=n.group,o=n.groupHeading,a=n.itemDisabled,s=t.id,c=t.label,l=t.disabled,u=he(c),h=document.createElement("div");ve(h,r),l&&ve(h,a),h.setAttribute("role","group"),h.dataset.group="",h.dataset.id=s,h.dataset.value=u,l&&h.setAttribute("aria-disabled","true");var d=document.createElement("div");return ve(d,o),pe(d,i,c||""),h.appendChild(d),h},choice:function(e,t,i,n){var r=e.allowHTML,o=e.classNames,a=o.item,s=o.itemChoice,c=o.itemSelectable,l=o.selectedState,u=o.itemDisabled,h=o.description,d=o.placeholder,p=t.label,f=he(t.value),g=document.createElement("div");g.id=t.elementId,ve(g,a),ve(g,s),n&&"string"==typeof p&&(p=de(r,p),p={trusted:p+=" (".concat(n,")")});var m=g;if(t.labelClass){var v=document.createElement("span");pe(v,r,p),ve(v,t.labelClass),m=v,g.appendChild(v)}else pe(g,r,p);if(t.labelDescription){var y="".concat(t.elementId,"-description");m.setAttribute("aria-describedby",y);var b=document.createElement("span");pe(b,r,t.labelDescription),b.id=y,ve(b,h),g.appendChild(b)}return t.selected&&ve(g,l),t.placeholder&&ve(g,d),g.setAttribute("role",t.group?"treeitem":"option"),g.dataset.choice="",g.dataset.id=t.id,g.dataset.value=f,i&&(g.dataset.selectText=i),t.group&&(g.dataset.groupId="".concat(t.group.id)),qt(g,t,!1),t.disabled?(ve(g,u),g.dataset.choiceDisabled="",g.setAttribute("aria-disabled","true")):(ve(g,c),g.dataset.choiceSelectable=""),g},input:function(e,t){var i=e.classNames,n=i.input,r=i.inputCloned,o=e.labelId,a=document.createElement("input");return a.type="search",ve(a,n),ve(a,r),a.autocomplete="off",a.autocapitalize="off",a.spellcheck=!1,a.setAttribute("role","textbox"),a.setAttribute("aria-autocomplete","list"),t?a.setAttribute("aria-label",t):o||Bt(this._docRoot,this.passedElement.element.id,a),a},dropdown:function(e){var t=e.classNames,i=t.list,n=t.listDropdown,r=document.createElement("div");return ve(r,i),ve(r,n),r.setAttribute("aria-expanded","false"),r},notice:function(e,t,i){var n=e.classNames,r=n.item,o=n.itemChoice,a=n.addChoice,s=n.noResults,c=n.noChoices,l=n.notice;void 0===i&&(i=Re);var u=document.createElement("div");switch(pe(u,!0,t),ve(u,r),ve(u,o),ve(u,l),i){case De:ve(u,a);break;case je:ve(u,s);break;case Fe:ve(u,c)}return i===De&&(u.dataset.choiceSelectable="",u.dataset.choice=""),u},option:function(e){var t=he(e.label),i=new Option(t,e.value,!1,e.selected);return qt(i,e,!0),i.disabled=e.disabled,e.selected&&i.setAttribute("selected",""),i}},Vt="-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,zt={},Kt=function(e){if(e)return e.dataset.id?parseInt(e.dataset.id,10):void 0},Gt="[data-choice-selectable]",$t=function(){function e(t,i){void 0===t&&(t="[data-choice]"),void 0===i&&(i={});var n=this;this.initialisedOK=void 0,this._hasNonChoicePlaceholder=!1,this._lastAddedChoiceId=0,this._lastAddedGroupId=0;var r=e.defaults;this.config=T(T(T({},r.allOptions),r.options),i),X.forEach((function(e){n.config[e]=T(T(T({},r.allOptions[e]),r.options[e]),i[e])}));var o=this.config;o.silent||this._validateConfig();var a=o.shadowRoot||document.documentElement;this._docRoot=a;var s="string"==typeof t?a.querySelector(t):t;if(!s||"object"!==b(s)||"INPUT"!==s.tagName&&!Me(s)){if(!s&&"string"==typeof t)throw TypeError("Selector ".concat(t," failed to find an element"));throw TypeError("Expected one of the following types text|select-one|select-multiple")}var c=s.type,l=c===ee;(l||1!==o.maxItemCount)&&(o.singleModeForMultiSelect=!1),o.singleModeForMultiSelect&&(c=ie);var u=c===te,h=c===ie,d=u||h;if(this._elementType=c,this._isTextElement=l,this._isSelectOneElement=u,this._isSelectMultipleElement=h,this._isSelectElement=u||h,this._canAddUserChoices=l&&o.addItems||d&&o.addChoices,"boolean"!=typeof o.renderSelectedChoices&&(o.renderSelectedChoices="always"===o.renderSelectedChoices||u),"auto"===o.closeDropdownOnSelect?o.closeDropdownOnSelect=l||u||o.singleModeForMultiSelect:o.closeDropdownOnSelect=Se(o.closeDropdownOnSelect),o.placeholder&&(o.placeholderValue?this._hasNonChoicePlaceholder=!0:s.dataset.placeholder&&(this._hasNonChoicePlaceholder=!0,o.placeholderValue=s.dataset.placeholder)),i.addItemFilter&&"function"!=typeof i.addItemFilter){var p=i.addItemFilter instanceof RegExp?i.addItemFilter:new RegExp(i.addItemFilter);o.addItemFilter=p.test.bind(p)}if(this._isTextElement)this.passedElement=new Ee({element:s,classNames:o.classNames});else{var f=s;this.passedElement=new Pe({element:f,classNames:o.classNames,template:function(e){return n._templates.option(e)},extractPlaceholder:o.placeholder&&!this._hasNonChoicePlaceholder})}if(this.initialised=!1,this._store=new Ne(o),this._currentValue="",o.searchEnabled=!l&&o.searchEnabled||h,this._canSearch=o.searchEnabled,this._isScrollingOnIe=!1,this._highlightPosition=0,this._wasTap=!0,this._placeholderValue=this._generatePlaceholderValue(),this._baseId=function(e,t){var i=e.id||e.name&&"".concat(e.name,"-").concat(ae(2))||ae(4);return i=i.replace(/(:|\.|\[|\]|,)/g,""),"".concat(t,"-").concat(i)}(s,"choices-"),this._direction=s.dir,!this._direction){var g=window.getComputedStyle(s).direction;g!==window.getComputedStyle(document.documentElement).direction&&(this._direction=g)}if(this._idNames={itemChoice:"item-choice"},this._templates=r.templates,this._render=this._render.bind(this),this._onFocus=this._onFocus.bind(this),this._onBlur=this._onBlur.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onInput=this._onInput.bind(this),this._onClick=this._onClick.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseOver=this._onMouseOver.bind(this),this._onFormReset=this._onFormReset.bind(this),this._onSelectKey=this._onSelectKey.bind(this),this._onEnterKey=this._onEnterKey.bind(this),this._onEscapeKey=this._onEscapeKey.bind(this),this._onDirectionKey=this._onDirectionKey.bind(this),this._onDeleteKey=this._onDeleteKey.bind(this),this.passedElement.isActive)return o.silent||console.warn("Trying to initialise Choices on element already initialised",{element:t}),this.initialised=!0,void(this.initialisedOK=!1);this.init(),this._initialItems=this._store.items.map((function(e){return e.value}))}return Object.defineProperty(e,"defaults",{get:function(){return Object.preventExtensions({get options(){return zt},get allOptions(){return Te},get templates(){return Ht}})},enumerable:!1,configurable:!0}),e.prototype.init=function(){if(!this.initialised&&void 0===this.initialisedOK){var e;this._searcher=(e=this.config,new Rt(e)),this._loadChoices(),this._createTemplates(),this._createElements(),this._createStructure(),this._isTextElement&&!this.config.addItems||this.passedElement.element.hasAttribute("disabled")||this.passedElement.element.closest("fieldset:disabled")?this.disable():(this.enable(),this._addEventListeners()),this._initStore(),this.initialised=!0,this.initialisedOK=!0;var t=this.config.callbackOnInit;"function"==typeof t&&t.call(this)}},e.prototype.destroy=function(){this.initialised&&(this._removeEventListeners(),this.passedElement.reveal(),this.containerOuter.unwrap(this.passedElement.element),this._store._listeners=[],this.clearStore(!1),this._stopSearch(),this._templates=e.defaults.templates,this.initialised=!1,this.initialisedOK=void 0)},e.prototype.enable=function(){return this.passedElement.isDisabled&&this.passedElement.enable(),this.containerOuter.isDisabled&&(this._addEventListeners(),this.input.enable(),this.containerOuter.enable()),this},e.prototype.disable=function(){return this.passedElement.isDisabled||this.passedElement.disable(),this.containerOuter.isDisabled||(this._removeEventListeners(),this.input.disable(),this.containerOuter.disable()),this},e.prototype.highlightItem=function(e,t){if(void 0===t&&(t=!0),!e||!e.id)return this;var i=this._store.items.find((function(t){return t.id===e.id}));return!i||i.highlighted||(this._store.dispatch(oe(i,!0)),t&&this.passedElement.triggerEvent(J,this._getChoiceForOutput(i))),this},e.prototype.unhighlightItem=function(e,t){if(void 0===t&&(t=!0),!e||!e.id)return this;var i=this._store.items.find((function(t){return t.id===e.id}));return i&&i.highlighted?(this._store.dispatch(oe(i,!1)),t&&this.passedElement.triggerEvent(Q,this._getChoiceForOutput(i)),this):this},e.prototype.highlightAll=function(){var e=this;return this._store.withTxn((function(){e._store.items.forEach((function(t){t.highlighted||(e._store.dispatch(oe(t,!0)),e.passedElement.triggerEvent(J,e._getChoiceForOutput(t)))}))})),this},e.prototype.unhighlightAll=function(){var e=this;return this._store.withTxn((function(){e._store.items.forEach((function(t){t.highlighted&&(e._store.dispatch(oe(t,!1)),e.passedElement.triggerEvent(J,e._getChoiceForOutput(t)))}))})),this},e.prototype.removeActiveItemsByValue=function(e){var t=this;return this._store.withTxn((function(){t._store.items.filter((function(t){return t.value===e})).forEach((function(e){return t._removeItem(e)}))})),this},e.prototype.removeActiveItems=function(e){var t=this;return this._store.withTxn((function(){t._store.items.filter((function(t){return t.id!==e})).forEach((function(e){return t._removeItem(e)}))})),this},e.prototype.removeHighlightedItems=function(e){var t=this;return void 0===e&&(e=!1),this._store.withTxn((function(){t._store.highlightedActiveItems.forEach((function(i){t._removeItem(i),e&&t._triggerChange(i.value)}))})),this},e.prototype.showDropdown=function(e){var t=this;return this.dropdown.isActive||requestAnimationFrame((function(){t.dropdown.show();var i=t.dropdown.element.getBoundingClientRect();t.containerOuter.open(i.bottom,i.height),!e&&t._canSearch&&t.input.focus(),t.passedElement.triggerEvent(z)})),this},e.prototype.hideDropdown=function(e){var t=this;return this.dropdown.isActive?(requestAnimationFrame((function(){t.dropdown.hide(),t.containerOuter.close(),!e&&t._canSearch&&(t.input.removeActiveDescendant(),t.input.blur()),t.passedElement.triggerEvent(K)})),this):this},e.prototype.getValue=function(e){var t=this,i=this._store.items.map((function(i){return e?i.value:t._getChoiceForOutput(i)}));return this._isSelectOneElement||this.config.singleModeForMultiSelect?i[0]:i},e.prototype.setValue=function(e){var t=this;return this.initialisedOK?(this._store.withTxn((function(){e.forEach((function(e){e&&t._addChoice(Ie(e,!1))}))})),this._searcher.reset(),this):(this._warnChoicesInitFailed("setValue"),this)},e.prototype.setChoiceByValue=function(e){var t=this;return this.initialisedOK?(this._isTextElement||(this._store.withTxn((function(){(Array.isArray(e)?e:[e]).forEach((function(e){return t._findAndSelectChoiceByValue(e)})),t.unhighlightAll()})),this._searcher.reset()),this):(this._warnChoicesInitFailed("setChoiceByValue"),this)},e.prototype.setChoices=function(e,t,i,n,r){var o=this;if(void 0===e&&(e=[]),void 0===t&&(t="value"),void 0===i&&(i="label"),void 0===n&&(n=!1),void 0===r&&(r=!0),!this.initialisedOK)return this._warnChoicesInitFailed("setChoices"),this;if(!this._isSelectElement)throw new TypeError("setChoices can't be used with INPUT based Choices");if("string"!=typeof t||!t)throw new TypeError("value parameter must be a name of 'value' field in passed objects");if(n&&this.clearChoices(),"function"==typeof e){var a=e(this);if("function"==typeof Promise&&a instanceof Promise)return new Promise((function(e){return requestAnimationFrame(e)})).then((function(){return o._handleLoadingState(!0)})).then((function(){return a})).then((function(e){return o.setChoices(e,t,i,n)})).catch((function(e){o.config.silent||console.error(e)})).then((function(){return o._handleLoadingState(!1)})).then((function(){return o}));if(!Array.isArray(a))throw new TypeError(".setChoices first argument function must return either array of choices or Promise, got: ".concat(b(a)));return this.setChoices(a,t,i,!1)}if(!Array.isArray(e))throw new TypeError(".setChoices must be called either with array of choices with a function resulting into Promise of array of choices");return this.containerOuter.removeLoadingState(),this._store.withTxn((function(){r&&(o._isSearching=!1);var n="value"===t,a="label"===i;e.forEach((function(e){if("choices"in e){var r=e;a||(r=T(T({},r),{label:r[i]})),o._addGroup(Ie(r,!0))}else{var s=e;a&&n||(s=T(T({},s),{value:s[t],label:s[i]})),o._addChoice(Ie(s,!1))}})),o.unhighlightAll()})),this._searcher.reset(),this},e.prototype.refresh=function(e,t,i){var n=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=!1),this._isSelectElement?(this._store.withTxn((function(){var r=n.passedElement.optionsAsChoices(),o={};i||n._store.items.forEach((function(e){e.id&&e.active&&e.selected&&!e.disabled&&(o[e.value]=!0)})),n.clearStore(!1);var a=function(e){i?n._store.dispatch(re(e)):o[e.value]&&(e.selected=!0)};r.forEach((function(e){"choices"in e?e.choices.forEach(a):a(e)})),n._addPredefinedChoices(r,t,e),n._isSearching&&n._searchChoices(n.input.value)})),this):(this.config.silent||console.warn("refresh method can only be used on choices backed by a <select> element"),this)},e.prototype.removeChoice=function(e){var t=this._store.choices.find((function(t){return t.value===e}));return t?(this._clearNotice(),this._store.dispatch(ne(t)),this._searcher.reset(),t.selected&&this.passedElement.triggerEvent(Y,this._getChoiceForOutput(t)),this):this},e.prototype.clearChoices=function(){var e=this;return this._store.withTxn((function(){e._store.choices.forEach((function(t){t.selected||e._store.dispatch(ne(t))}))})),this._searcher.reset(),this},e.prototype.clearStore=function(e){return void 0===e&&(e=!0),this._stopSearch(),e&&this.passedElement.element.replaceChildren(""),this.itemList.element.replaceChildren(""),this.choiceList.element.replaceChildren(""),this._store.reset(),this._lastAddedChoiceId=0,this._lastAddedGroupId=0,this._searcher.reset(),this},e.prototype.clearInput=function(){var e=!this._isSelectOneElement;return this.input.clear(e),this._stopSearch(),this},e.prototype._validateConfig=function(){var e,t,i,n,r=this.config,o=(e=r,t=Te,i=Object.keys(e).sort(),n=Object.keys(t).sort(),i.filter((function(e){return n.indexOf(e)<0})));o.length&&console.warn("Unknown config option(s) passed",o.join(", ")),r.allowHTML&&r.allowHtmlUserInput&&(r.addItems&&console.warn("Warning: allowHTML/allowHtmlUserInput/addItems all being true is strongly not recommended and may lead to XSS attacks"),r.addChoices&&console.warn("Warning: allowHTML/allowHtmlUserInput/addChoices all being true is strongly not recommended and may lead to XSS attacks"))},e.prototype._render=function(e){void 0===e&&(e={choices:!0,groups:!0,items:!0}),this._store.inTxn()||(this._isSelectElement&&(e.choices||e.groups)&&this._renderChoices(),e.items&&this._renderItems())},e.prototype._renderChoices=function(){var e=this;if(this._canAddItems()){var t=this.config,i=this._isSearching,n=this._store,r=n.activeGroups,o=n.activeChoices,a=0;if(i&&t.searchResultLimit>0?a=t.searchResultLimit:t.renderChoiceLimit>0&&(a=t.renderChoiceLimit),this._isSelectElement){var s=o.filter((function(e){return!e.element}));s.length&&this.passedElement.addOptions(s)}var c=document.createDocumentFragment(),l=function(e){return e.filter((function(e){return!e.placeholder&&(i?!!e.rank:t.renderSelectedChoices||!e.selected)}))},u=!1,h=function(n,r,o){i?n.sort(fe):t.shouldSort&&n.sort(t.sorter);var s=n.length;s=!r&&a&&s>a?a:s,s--,n.every((function(n,r){var a=n.choiceEl||e._templates.choice(t,n,t.itemSelectText,o);return n.choiceEl=a,c.appendChild(a),n.disabled||!i&&n.selected||(u=!0),r<s}))};o.length&&(t.resetScrollPosition&&requestAnimationFrame((function(){return e.choiceList.scrollToTop()})),this._hasNonChoicePlaceholder||i||!this._isSelectOneElement||h(o.filter((function(e){return e.placeholder&&!e.group})),!1,void 0),r.length&&!i?(t.shouldSort&&r.sort(t.sorter),h(o.filter((function(e){return!e.placeholder&&!e.group})),!1,void 0),r.forEach((function(n){var r=l(n.choices);if(r.length){if(n.label){var o=n.groupEl||e._templates.choiceGroup(e.config,n);n.groupEl=o,o.remove(),c.appendChild(o)}h(r,!0,t.appendGroupInSearch&&i?n.label:void 0)}}))):h(l(o),!1,void 0)),u||(this._notice||(this._notice={text:ue(i?t.noResultsText:t.noChoicesText),type:i?je:Fe}),c.replaceChildren("")),this._renderNotice(c),this.choiceList.element.replaceChildren(c),u&&this._highlightChoice()}},e.prototype._renderItems=function(){var e=this,t=this._store.items||[],i=this.itemList.element,n=this.config,r=document.createDocumentFragment(),o=function(e){return i.querySelector('[data-item][data-id="'.concat(e.id,'"]'))},a=function(t){var i=t.itemEl;i&&i.parentElement||(i=o(t)||e._templates.item(n,t,n.removeItemButton),t.itemEl=i,r.appendChild(i))};t.forEach(a);var s=!!r.childNodes.length;if(this._isSelectOneElement&&this._hasNonChoicePlaceholder){var c=i.children.length;if(s||c>1){var l=i.querySelector(me(n.classNames.placeholder));l&&l.remove()}else c||(s=!0,a(Ie({selected:!0,value:"",label:n.placeholderValue||"",placeholder:!0},!1)))}s&&(i.append(r),n.shouldSortItems&&!this._isSelectOneElement&&(t.sort(n.sorter),t.forEach((function(e){var t=o(e);t&&(t.remove(),r.append(t))})),i.append(r))),this._isTextElement&&(this.passedElement.value=t.map((function(e){return e.value})).join(n.delimiter))},e.prototype._displayNotice=function(e,t,i){void 0===i&&(i=!0);var n=this._notice;n&&(n.type===t&&n.text===e||n.type===De&&(t===je||t===Fe))?i&&this.showDropdown(!0):(this._clearNotice(),this._notice=e?{text:e,type:t}:void 0,this._renderNotice(),i&&e&&this.showDropdown(!0))},e.prototype._clearNotice=function(){if(this._notice){var e=this.choiceList.element.querySelector(me(this.config.classNames.notice));e&&e.remove(),this._notice=void 0}},e.prototype._renderNotice=function(e){var t=this._notice;if(t){var i=this._templates.notice(this.config,t.text,t.type);e?e.append(i):this.choiceList.prepend(i)}},e.prototype._getChoiceForOutput=function(e,t){return{id:e.id,highlighted:e.highlighted,labelClass:e.labelClass,labelDescription:e.labelDescription,customProperties:e.customProperties,disabled:e.disabled,active:e.active,label:e.label,placeholder:e.placeholder,value:e.value,groupValue:e.group?e.group.label:void 0,element:e.element,keyCode:t}},e.prototype._triggerChange=function(e){null!=e&&this.passedElement.triggerEvent(G,{value:e})},e.prototype._handleButtonAction=function(e){var t=this,i=this._store.items;if(i.length&&this.config.removeItems&&this.config.removeItemButton){var n=e&&Kt(e.parentElement),r=n&&i.find((function(e){return e.id===n}));r&&this._store.withTxn((function(){if(t._removeItem(r),t._triggerChange(r.value),t._isSelectOneElement&&!t._hasNonChoicePlaceholder){var e=t._store.choices.reverse().find((function(e){return!e.disabled&&e.placeholder}));e&&(t._addItem(e),t.unhighlightAll(),e.value&&t._triggerChange(e.value))}}))}},e.prototype._handleItemAction=function(e,t){var i=this;void 0===t&&(t=!1);var n=this._store.items;if(n.length&&this.config.removeItems&&!this._isSelectOneElement){var r=Kt(e);r&&(n.forEach((function(e){e.id!==r||e.highlighted?!t&&e.highlighted&&i.unhighlightItem(e):i.highlightItem(e)})),this.input.focus())}},e.prototype._handleChoiceAction=function(e){var t=this,i=Kt(e),n=i&&this._store.getChoiceById(i);if(!n||n.disabled)return!1;var r=this.dropdown.isActive;if(!n.selected){if(!this._canAddItems())return!0;this._store.withTxn((function(){t._addItem(n,!0,!0),t.clearInput(),t.unhighlightAll()})),this._triggerChange(n.value)}return r&&this.config.closeDropdownOnSelect&&(this.hideDropdown(!0),this.containerOuter.element.focus()),!0},e.prototype._handleBackspace=function(e){var t=this.config;if(t.removeItems&&e.length){var i=e[e.length-1],n=e.some((function(e){return e.highlighted}));t.editItems&&!n&&i?(this.input.value=i.value,this.input.setWidth(),this._removeItem(i),this._triggerChange(i.value)):(n||this.highlightItem(i,!1),this.removeHighlightedItems(!0))}},e.prototype._loadChoices=function(){var e,t=this.config;if(this._isTextElement){if(this._presetChoices=t.items.map((function(e){return Ie(e,!1)})),this.passedElement.value){var i=this.passedElement.value.split(t.delimiter).map((function(e){return Ie(e,!1)}));this._presetChoices=this._presetChoices.concat(i)}this._presetChoices.forEach((function(e){e.selected=!0}))}else if(this._isSelectElement){this._presetChoices=t.choices.map((function(e){return Ie(e,!0)}));var n=this.passedElement.optionsAsChoices();n&&(e=this._presetChoices).push.apply(e,n)}},e.prototype._handleLoadingState=function(e){void 0===e&&(e=!0);var t=this.itemList.element;e?(this.disable(),this.containerOuter.addLoadingState(),this._isSelectOneElement?t.replaceChildren(this._templates.placeholder(this.config,this.config.loadingText)):this.input.placeholder=this.config.loadingText):(this.enable(),this.containerOuter.removeLoadingState(),this._isSelectOneElement?(t.replaceChildren(""),this._render()):this.input.placeholder=this._placeholderValue||"")},e.prototype._handleSearch=function(e){if(this.input.isFocussed)if(null!=e&&e.length>=this.config.searchFloor){var t=this.config.searchChoices?this._searchChoices(e):0;null!==t&&this.passedElement.triggerEvent(W,{value:e,resultCount:t})}else this._store.choices.some((function(e){return!e.active}))&&this._stopSearch()},e.prototype._canAddItems=function(){var e=this.config,t=e.maxItemCount,i=e.maxItemText;return!(!e.singleModeForMultiSelect&&t>0&&t<=this._store.items.length)||(this.choiceList.element.replaceChildren(""),this._displayNotice("function"==typeof i?i(t):i,De),!1)},e.prototype._canCreateItem=function(e){var t=this.config,i=!0,n="";if(i&&"function"==typeof t.addItemFilter&&!t.addItemFilter(e)&&(i=!1,n=le(t.customAddItemText,e)),i){var r=this._store.choices.find((function(i){return t.valueComparer(i.value,e)}));if(this._isSelectElement){if(r)return this._displayNotice("",De),!1}else this._isTextElement&&!t.duplicateItemsAllowed&&r&&(i=!1,n=le(t.uniqueItemText,e))}return i&&(n=le(t.addItemText,e)),n&&this._displayNotice(n,De),i},e.prototype._searchChoices=function(e){var t=e.trim().replace(/\s{2,}/," ");if(!t.length||t===this._currentValue)return null;var i=this._searcher;i.isEmptyIndex()&&i.index(this._store.searchableChoices);var n=i.search(t);this._currentValue=t,this._highlightPosition=0,this._isSearching=!0;var r=this._notice;return(r&&r.type)!==De&&(n.length?this._clearNotice():this._displayNotice(ue(this.config.noResultsText),je)),this._store.dispatch(function(e){return{type:j,results:e}}(n)),n.length},e.prototype._stopSearch=function(){this._isSearching&&(this._currentValue="",this._isSearching=!1,this._clearNotice(),this._store.dispatch({type:D,active:!0}),this.passedElement.triggerEvent(W,{value:"",resultCount:0}))},e.prototype._addEventListeners=function(){var e=this._docRoot,t=this.containerOuter.element,i=this.input.element;e.addEventListener("touchend",this._onTouchEnd,!0),t.addEventListener("keydown",this._onKeyDown,!0),t.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("click",this._onClick,{passive:!0}),e.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.dropdown.element.addEventListener("mouseover",this._onMouseOver,{passive:!0}),this._isSelectOneElement&&(t.addEventListener("focus",this._onFocus,{passive:!0}),t.addEventListener("blur",this._onBlur,{passive:!0})),i.addEventListener("keyup",this._onKeyUp,{passive:!0}),i.addEventListener("input",this._onInput,{passive:!0}),i.addEventListener("focus",this._onFocus,{passive:!0}),i.addEventListener("blur",this._onBlur,{passive:!0}),i.form&&i.form.addEventListener("reset",this._onFormReset,{passive:!0}),this.input.addEventListeners()},e.prototype._removeEventListeners=function(){var e=this._docRoot,t=this.containerOuter.element,i=this.input.element;e.removeEventListener("touchend",this._onTouchEnd,!0),t.removeEventListener("keydown",this._onKeyDown,!0),t.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("click",this._onClick),e.removeEventListener("touchmove",this._onTouchMove),this.dropdown.element.removeEventListener("mouseover",this._onMouseOver),this._isSelectOneElement&&(t.removeEventListener("focus",this._onFocus),t.removeEventListener("blur",this._onBlur)),i.removeEventListener("keyup",this._onKeyUp),i.removeEventListener("input",this._onInput),i.removeEventListener("focus",this._onFocus),i.removeEventListener("blur",this._onBlur),i.form&&i.form.removeEventListener("reset",this._onFormReset),this.input.removeEventListeners()},e.prototype._onKeyDown=function(e){var t=e.keyCode,i=this.dropdown.isActive,n=1===e.key.length||2===e.key.length&&e.key.charCodeAt(0)>=55296||"Unidentified"===e.key;switch(this._isTextElement||i||(this.showDropdown(),!this.input.isFocussed&&n&&(this.input.value+=e.key," "===e.key&&e.preventDefault())),t){case 65:return this._onSelectKey(e,this.itemList.element.hasChildNodes());case 13:return this._onEnterKey(e,i);case 27:return this._onEscapeKey(e,i);case 38:case 33:case 40:case 34:return this._onDirectionKey(e,i);case 8:case 46:return this._onDeleteKey(e,this._store.items,this.input.isFocussed)}},e.prototype._onKeyUp=function(){this._canSearch=this.config.searchEnabled},e.prototype._onInput=function(){var e=this.input.value;e?this._canAddItems()&&(this._canSearch&&this._handleSearch(e),this._canAddUserChoices&&(this._canCreateItem(e),this._isSelectElement&&(this._highlightPosition=0,this._highlightChoice()))):this._isTextElement?this.hideDropdown(!0):this._stopSearch()},e.prototype._onSelectKey=function(e,t){(e.ctrlKey||e.metaKey)&&t&&(this._canSearch=!1,this.config.removeItems&&!this.input.value&&this.input.element===document.activeElement&&this.highlightAll())},e.prototype._onEnterKey=function(e,t){var i=this,n=this.input.value,r=e.target;if(e.preventDefault(),r&&r.hasAttribute("data-button"))this._handleButtonAction(r);else if(t){var o=this.dropdown.element.querySelector(me(this.config.classNames.highlightedState));if(!o||!this._handleChoiceAction(o))if(r&&n){if(this._canAddItems()){var a=!1;this._store.withTxn((function(){if(!(a=i._findAndSelectChoiceByValue(n,!0))){if(!i._canAddUserChoices)return;if(!i._canCreateItem(n))return;var e=se(n),t=i.config.allowHtmlUserInput||e===n?n:{escaped:e,raw:n};i._addChoice(Ie({value:t,label:t,selected:!0},!1),!0,!0),a=!0}i.clearInput(),i.unhighlightAll()})),a&&(this._triggerChange(n),this.config.closeDropdownOnSelect&&this.hideDropdown(!0))}}else this.hideDropdown(!0)}else(this._isSelectElement||this._notice)&&this.showDropdown()},e.prototype._onEscapeKey=function(e,t){t&&(e.stopPropagation(),this.hideDropdown(!0),this.containerOuter.element.focus())},e.prototype._onDirectionKey=function(e,t){var i,n,r,o=e.keyCode;if(t||this._isSelectOneElement){this.showDropdown(),this._canSearch=!1;var a=40===o||34===o?1:-1,s=void 0;if(e.metaKey||34===o||33===o)s=a>0?this.dropdown.element.querySelector("".concat(Gt,":last-of-type")):this.dropdown.element.querySelector(Gt);else{var c=this.dropdown.element.querySelector(me(this.config.classNames.highlightedState));s=c?function(e,t,i){void 0===i&&(i=1);for(var n="".concat(i>0?"next":"previous","ElementSibling"),r=e[n];r;){if(r.matches(t))return r;r=r[n]}return null}(c,Gt,a):this.dropdown.element.querySelector(Gt)}s&&(i=s,n=this.choiceList.element,void 0===(r=a)&&(r=1),(r>0?n.scrollTop+n.offsetHeight>=i.offsetTop+i.offsetHeight:i.offsetTop>=n.scrollTop)||this.choiceList.scrollToChildElement(s,a),this._highlightChoice(s)),e.preventDefault()}},e.prototype._onDeleteKey=function(e,t,i){this._isSelectOneElement||e.target.value||!i||(this._handleBackspace(t),e.preventDefault())},e.prototype._onTouchMove=function(){this._wasTap&&(this._wasTap=!1)},e.prototype._onTouchEnd=function(e){var t=(e||e.touches[0]).target;this._wasTap&&this.containerOuter.element.contains(t)&&((t===this.containerOuter.element||t===this.containerInner.element)&&(this._isTextElement?this.input.focus():this._isSelectMultipleElement&&this.showDropdown()),e.stopPropagation());this._wasTap=!0},e.prototype._onMouseDown=function(e){var t=e.target;if(t instanceof HTMLElement){if(Vt&&this.choiceList.element.contains(t)){var i=this.choiceList.element.firstElementChild;this._isScrollingOnIe="ltr"===this._direction?e.offsetX>=i.offsetWidth:e.offsetX<i.offsetLeft}if(t!==this.input.element){var n=t.closest("[data-button],[data-item],[data-choice]");n instanceof HTMLElement&&("button"in n.dataset?this._handleButtonAction(n):"item"in n.dataset?this._handleItemAction(n,e.shiftKey):"choice"in n.dataset&&this._handleChoiceAction(n)),e.preventDefault()}}},e.prototype._onMouseOver=function(e){var t=e.target;t instanceof HTMLElement&&"choice"in t.dataset&&this._highlightChoice(t)},e.prototype._onClick=function(e){var t=e.target,i=this.containerOuter;i.element.contains(t)?this.dropdown.isActive||i.isDisabled?this._isSelectOneElement&&t!==this.input.element&&!this.dropdown.element.contains(t)&&this.hideDropdown():this._isTextElement?document.activeElement!==this.input.element&&this.input.focus():(this.showDropdown(),i.element.focus()):(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll())},e.prototype._onFocus=function(e){var t=e.target,i=this.containerOuter;if(t&&i.element.contains(t)){var n=t===this.input.element;this._isTextElement?n&&i.addFocusState():this._isSelectMultipleElement?n&&(this.showDropdown(!0),i.addFocusState()):(i.addFocusState(),n&&this.showDropdown(!0))}},e.prototype._onBlur=function(e){var t=e.target,i=this.containerOuter;if(t&&i.element.contains(t)&&!this._isScrollingOnIe){var n=t===this.input.element;this._isTextElement||this._isSelectMultipleElement?n&&(i.removeFocusState(),this.hideDropdown(!0),this.unhighlightAll()):(i.removeFocusState(),(n||t===i.element&&!this._canSearch)&&this.hideDropdown(!0))}else this._isScrollingOnIe=!1,this.input.element.focus()},e.prototype._onFormReset=function(){var e=this;this._store.withTxn((function(){e.clearInput(),e.hideDropdown(),e.refresh(!1,!1,!0),e._initialItems.length&&e.setChoiceByValue(e._initialItems)}))},e.prototype._highlightChoice=function(e){void 0===e&&(e=null);var t=Array.from(this.dropdown.element.querySelectorAll(Gt));if(t.length){var i=e,n=this.config.classNames.highlightedState;Array.from(this.dropdown.element.querySelectorAll(me(n))).forEach((function(e){ye(e,n),e.setAttribute("aria-selected","false")})),i?this._highlightPosition=t.indexOf(i):(i=t.length>this._highlightPosition?t[this._highlightPosition]:t[t.length-1])||(i=t[0]),ve(i,n),i.setAttribute("aria-selected","true"),this.passedElement.triggerEvent(Z,{el:i}),this.dropdown.isActive&&(this.input.setActiveDescendant(i.id),this.containerOuter.setActiveDescendant(i.id))}},e.prototype._addItem=function(e,t,i){if(void 0===t&&(t=!0),void 0===i&&(i=!1),!e.id)throw new TypeError("item.id must be set before _addItem is called for a choice/item");(this.config.singleModeForMultiSelect||this._isSelectOneElement)&&this.removeActiveItems(e.id),this._store.dispatch(function(e){return{type:B,item:e}}(e)),t&&(this.passedElement.triggerEvent(U,this._getChoiceForOutput(e)),i&&this.passedElement.triggerEvent($,this._getChoiceForOutput(e)))},e.prototype._removeItem=function(e){e.id&&(this._store.dispatch(re(e)),this.passedElement.triggerEvent(Y,this._getChoiceForOutput(e)))},e.prototype._addChoice=function(e,t,i){if(void 0===t&&(t=!0),void 0===i&&(i=!1),e.id)throw new TypeError("Can not re-add a choice which has already been added");var n=this.config;if(!this._isSelectElement&&n.duplicateItemsAllowed||!this._store.choices.find((function(t){return n.valueComparer(t.value,e.value)}))){this._lastAddedChoiceId++,e.id=this._lastAddedChoiceId,e.elementId="".concat(this._baseId,"-").concat(this._idNames.itemChoice,"-").concat(e.id);var r=n.prependValue,o=n.appendValue;r&&(e.value=r+e.value),o&&(e.value+=o.toString()),(r||o)&&e.element&&(e.element.value=e.value),this._clearNotice(),this._store.dispatch(function(e){return{type:N,choice:e}}(e)),e.selected&&this._addItem(e,t,i)}},e.prototype._addGroup=function(e,t){var i=this;if(void 0===t&&(t=!0),e.id)throw new TypeError("Can not re-add a group which has already been added");this._store.dispatch(function(e){return{type:q,group:e}}(e)),e.choices&&(this._lastAddedGroupId++,e.id=this._lastAddedGroupId,e.choices.forEach((function(n){n.group=e,e.disabled&&(n.disabled=!0),i._addChoice(n,t)})))},e.prototype._createTemplates=function(){var e=this,t=this.config.callbackOnCreateTemplates,i={};"function"==typeof t&&(i=t.call(this,ce,de,ge));var n={};Object.keys(this._templates).forEach((function(t){n[t]=t in i?i[t].bind(e):e._templates[t].bind(e)})),this._templates=n},e.prototype._createElements=function(){var e=this._templates,t=this.config,i=this._isSelectOneElement,n=t.position,r=t.classNames,o=this._elementType;this.containerOuter=new ke({element:e.containerOuter(t,this._direction,this._isSelectElement,i,t.searchEnabled,o,t.labelId),classNames:r,type:o,position:n}),this.containerInner=new ke({element:e.containerInner(t),classNames:r,type:o,position:n}),this.input=new xe({element:e.input(t,this._placeholderValue),classNames:r,type:o,preventPaste:!t.paste}),this.choiceList=new we({element:e.choiceList(t,i)}),this.itemList=new we({element:e.itemList(t,i)}),this.dropdown=new _e({element:e.dropdown(t),classNames:r,type:o})},e.prototype._createStructure=function(){var e=this,t=e.containerInner,i=e.containerOuter,n=e.passedElement,r=this.dropdown.element;n.conceal(),t.wrap(n.element),i.wrap(t.element),this._isSelectOneElement?this.input.placeholder=this.config.searchPlaceholderValue||"":(this._placeholderValue&&(this.input.placeholder=this._placeholderValue),this.input.setWidth()),i.element.appendChild(t.element),i.element.appendChild(r),t.element.appendChild(this.itemList.element),r.appendChild(this.choiceList.element),this._isSelectOneElement?this.config.searchEnabled&&r.insertBefore(this.input.element,r.firstChild):t.element.appendChild(this.input.element),this._highlightPosition=0,this._isSearching=!1},e.prototype._initStore=function(){var e=this;this._store.subscribe(this._render).withTxn((function(){e._addPredefinedChoices(e._presetChoices,e._isSelectOneElement&&!e._hasNonChoicePlaceholder,!1)})),(!this._store.choices.length||this._isSelectOneElement&&this._hasNonChoicePlaceholder)&&this._render()},e.prototype._addPredefinedChoices=function(e,t,i){var n=this;(void 0===t&&(t=!1),void 0===i&&(i=!0),t)&&(-1===e.findIndex((function(e){return e.selected}))&&e.some((function(e){return!e.disabled&&!("choices"in e)&&(e.selected=!0,!0)})));e.forEach((function(e){"choices"in e?n._isSelectElement&&n._addGroup(e,i):n._addChoice(e,i)}))},e.prototype._findAndSelectChoiceByValue=function(e,t){var i=this;void 0===t&&(t=!1);var n=this._store.choices.find((function(t){return i.config.valueComparer(t.value,e)}));return!(!n||n.disabled||n.selected)&&(this._addItem(n,!0,t),!0)},e.prototype._generatePlaceholderValue=function(){var e=this.config;if(!e.placeholder)return null;if(this._hasNonChoicePlaceholder)return e.placeholderValue;if(this._isSelectElement){var t=this.passedElement.placeholderOption;return t?t.text:null}return null},e.prototype._warnChoicesInitFailed=function(e){if(!this.config.silent){if(!this.initialised)throw new TypeError("".concat(e," called on a non-initialised instance of Choices"));if(!this.initialisedOK)throw new TypeError("".concat(e," called for an element which has multiple instances of Choices initialised on it"))}},e.version="11.0.2",e}(),Wt=function(){return a((function e(t){r(this,e),this.identityPicker=t,this.uniqueId=t.uniqueId,this.birthcountryChoices=null,this.birthplaceChoices=null,this.identity=null}),[{key:"showCreateIdentityForm",value:(o=i(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.identityPicker.showLoading(this.identityPicker.rules.language.loading),this.identity=null,e.next=4,this.displayForm("create");case 4:this.identityPicker.hideLoading();case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"showModifyIdentityForm",value:(n=i(f().mark((function e(t){var i,n,r,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.identityPicker.showLoading(this.identityPicker.rules.language.loading),i="".concat(this.identityPicker.config.endpoints.identity,"/").concat(t),e.prev=2,e.next=5,fetch(i);case 5:if((n=e.sent).ok){e.next=8;break}throw n;case 8:return e.next=10,n.json();case 10:this.identity=e.sent,this.displayForm("modify"),e.next=20;break;case 14:e.prev=14,e.t0=e.catch(2),console.error(this.identityPicker.rules.language.fetchError,e.t0),r=e.t0 instanceof Response?403===e.t0.status?"".concat(this.identityPicker.rules.language.httpError," 403"):"".concat(this.identityPicker.rules.language.httpError," ").concat(e.t0.status):e.t0.message,o=r.includes("403")?"noPermissions":"errorMessage",this.identityPicker.showInfoMessage(o,"error",r);case 20:return e.prev=20,this.identityPicker.hideLoading(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[2,14,20,23]])}))),function(e){return n.apply(this,arguments)})},{key:"displayForm",value:(t=i(f().mark((function e(t){var i,n,r,o,a,s,c,l=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i="ip-".concat(t,"-form-").concat(this.uniqueId),n='<form id="'.concat(i,'">'),r=0,o=Object.entries(w);r<o.length;r++)a=m(o[r],2),s=a[0],c=a[1],n+='<fieldset class="ip-fieldset">\n                     <legend>'.concat(this.identityPicker.rules.language["".concat(s,"Group")],"</legend>"),c.attributes.forEach((function(e){n+=l.generateAttributeField(e)})),n+="</fieldset>";n+='<div class="ip-container-buttons">\n        <button class="ip-button-back ip-button-light" type="button">'.concat(this.identityPicker.rules.language.backButton,'</button>\n        <button type="submit">').concat("create"===t?this.identityPicker.rules.language.createButton:this.identityPicker.rules.language.modifyButton,"</button>\n        </div></form>"),this.identityPicker.createIdentityContainer.innerHTML=n,this.identityPicker.createIdentityContainer.querySelector(".ip-button-back").addEventListener("click",(function(){"create"===t?l.identityPicker.showSearchView():l.identityPicker.identityView.loadIdentityDetails(l.identity.customer_id)})),this.identityPicker.showCreateIdentityView(t),this.initializeFormBehavior(i,t);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"generateAttributeField",value:function(e){var t=this;if("birthcountry_code"===e||"birthplace_code"===e){var i=this.identity?E(this.identity,e):"";return'<input type="hidden" id="'.concat(e,'" name="').concat(e,'" value="').concat(i,'">')}var n=this.identityPicker.rules.contract.attributeDefinitions.find((function(t){return t.keyName===e}));if(!n||!n.attributeRight.writable)return"";var r=this.identity?this.identity.attributes.find((function(t){return t.key===e})):null,o=r?r.value:"";return'\n      <div class="ip-form-row">\n        <div class="ip-form-input">\n          <label for="'.concat(n.keyName,'">').concat(n.name," ").concat(n.attributeRight.mandatory?'<span class="ip-required">'.concat(this.identityPicker.rules.language.mandatory,"</span>"):"","</label>\n          ").concat(this.getInputFieldHtml(n,o),'\n        </div>\n        <div class="ip-form-select">\n          <label for="').concat(n.keyName,'-certification">').concat(this.identityPicker.rules.language.selectCertification," ").concat(n.attributeRight.mandatory?'<span class="ip-required">'.concat(this.identityPicker.rules.language.mandatory,"</span>"):"",'</label>\n          <select id="').concat(n.keyName,'-certification" name="').concat(n.keyName,'-certification" class="ip-select" ').concat(n.attributeRight.mandatory?"required":"",'>\n            <option value="" ').concat(null!=r&&r.certProcess?"":"selected"," disabled>").concat(this.identityPicker.rules.language.selectCertification,"</option>\n            ").concat(n.attributeCertifications.sort((function(e,t){return parseInt(e.level)-parseInt(t.level)})).map((function(e){return'<option value="'.concat(e.code,'" ').concat((null==r?void 0:r.certProcess)===e.code?"selected":"",">").concat(e.label," (").concat(t.identityPicker.rules.language.qualityLabel," ").concat(e.level,")</option>")})).join(""),"\n          </select>\n        </div>\n      </div>")}},{key:"getInputFieldHtml",value:function(e,t){if("birthcountry"===e.keyName)return'\n        <select id="birthcountry" name="birthcountry" class="ip-birthcountry-select" '.concat(e.attributeRight.mandatory?"required":"",">\n          ").concat(t?'<option value="'.concat(t,'" selected>').concat(t,"</option>"):"","\n        </select>");if("birthdate"===e.keyName){var i="";if(t){var n=t.split("/");3===n.length&&(i="".concat(n[2],"-").concat(n[1],"-").concat(n[0]))}return'<input type="date" id="'.concat(e.keyName,'" name="').concat(e.keyName,'" value="').concat(i,'" ').concat(e.attributeRight.mandatory?"required":"",">")}var r=this.identityPicker.rules.referential.attributeKeyList.attributeKeys.find((function(t){return t.keyName===e.keyName}));return r&&r.values&&r.values.length>0?'\n          <select id="'.concat(e.keyName,'" class="ip-select" name="').concat(e.keyName,'" ').concat(e.attributeRight.mandatory?"required":"",'>\n            <option value="" ').concat(t?"":"selected"," disabled>").concat(this.identityPicker.rules.language.selectValue,"</option>\n            ").concat(r.values.map((function(e){return'\n              <option value="'.concat(e.value,'" ').concat(e.value===t?"selected":"",">").concat(e.label,"</option>\n            ")})).join(""),"\n          </select>"):'<input type="text" id="'.concat(e.keyName,'" name="').concat(e.keyName,'" value="').concat(t,'" ').concat(e.attributeRight.mandatory?"required":"",">")}},{key:"initializeFormBehavior",value:function(e,t){var i=this;this.initializeChoices(),this.initBirthcountrySelect(),this.applyFormRules(),this.identityPicker.createIdentityContainer.querySelector("#".concat(e)).addEventListener("submit",(function(e){e.preventDefault(),i.submitForm(e.target,t)}));var n=this.identityPicker.createIdentityContainer.querySelector("#birthdate"),r=this.identityPicker.createIdentityContainer.querySelector("#birthcountry");n&&n.addEventListener("change",(function(){return i.applyFormRules()})),r&&r.addEventListener("change",(function(){return i.applyFormRules()}))}},{key:"submitForm",value:(e=i(f().mark((function e(t,i){var n,r,o,a,c,l,u,h,d,p,g,v,y,b,_,k,x;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new FormData(t),r={},o=s(n.entries());try{for(o.s();!(a=o.n()).done;)c=m(a.value,2),l=c[0],u=c[1],h=l.split("-"),d=m(h,2),p=d[0],g=d[1],r[p]||(r[p]={}),"certification"===g?r[p].certification=u:r[p].value=u}catch(e){o.e(e)}finally{o.f()}return v="create"===i?this.identityPicker.config.endpoints.identity:"".concat(this.identityPicker.config.endpoints.identity,"/").concat(this.identity.customer_id),this.identityPicker.showLoading(this.identityPicker.rules.language.loading),e.prev=6,e.next=9,fetch(v,{method:"create"===i?"POST":"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 9:return y=e.sent,e.next=12,y.json();case 12:if(b=e.sent,y.ok){e.next=15;break}throw b;case 15:return _="create"===i?"successCreate":"successModify",this.identityPicker.showInfoMessage(_,"success"),e.next=19,this.identityPicker.identityView.loadIdentityDetails(b.customer_id);case 19:e.next=28;break;case 21:e.prev=21,e.t0=e.catch(6),console.error(this.identityPicker.rules.language.fetchError,e.t0),e.t0.status&&e.t0.status.message?(k=e.t0.status.message,this.handleSaveError(e.t0)):k=e.t0 instanceof Response?"".concat(this.identityPicker.rules.language.httpError," ").concat(e.t0.status):e.t0.message||this.identityPicker.rules.language.unknownError,x=k.includes("403")?"noPermissions":"errorMessage",this.identityPicker.showInfoMessage(x,"error",k),this.clearFieldErrors();case 28:return e.prev=28,this.identityPicker.hideLoading(),e.finish(28);case 31:case"end":return e.stop()}}),e,this,[[6,21,28,31]])}))),function(t,i){return e.apply(this,arguments)})},{key:"initializeChoices",value:function(){document.querySelectorAll(".ip-select").forEach((function(e){new $t(e,{searchEnabled:!1,itemSelectText:"",shouldSort:!1,placeholder:!0})}))}},{key:"initBirthcountrySelect",value:function(){var e=this,t=document.querySelector(".ip-birthcountry-select");t&&(this.birthcountryChoices=new $t(t,{searchEnabled:!0,itemSelectText:"",placeholder:!0,placeholderValue:this.identityPicker.rules.language.selectCountry,searchPlaceholderValue:this.identityPicker.rules.language.searchCountry,shouldSort:!1,noResultsText:this.identityPicker.rules.language.noCountryResults,noChoicesText:this.identityPicker.rules.language.noCountryAvailable,loadingText:this.identityPicker.rules.language.loadingCountries}),this.birthcountryChoices.passedElement.element.addEventListener("search",C((function(t){var i=t.detail.value;i&&i.length>=e.identityPicker.config.choices.minSearchLength&&e.fetchGeoCode("birthcountry",i,"2000-01-01",e.birthcountryChoices)}),this.identityPicker.config.choices.debounceTime)),this.birthcountryChoices.passedElement.element.addEventListener("choice",(function(t){var i=e.identityPicker.createIdentityContainer.querySelector("#birthcountry_code");i&&(i.value=t.detail.value,e.applyFormRules())})))}},{key:"fetchGeoCode",value:function(e,t,i,n){var r=this,o="".concat(this.identityPicker.config.endpoints["birthcountry"===e?"countries":"cities"],"?search=").concat(encodeURIComponent(t),"&additionalParam=").concat(encodeURIComponent(i));fetch(o,{headers:{accept:"application/json"}}).then((function(e){return e.json()})).then((function(e){if("OK"===e.status&&e.result){var t=e.result.map((function(e){return{value:e.code,label:e.value}}));n.setChoices(t,"value","label",!0)}else n.setChoices([],"value","label",!0)})).catch((function(t){console.error("".concat(r.identityPicker.rules.language.fetchError," ").concat("birthcountry"===e?r.identityPicker.rules.language.loadingCountries:r.identityPicker.rules.language.loadingCities),t),n.setChoices([],"value","label",!0)}))}},{key:"applyFormRules",value:function(){var e=this.identityPicker.createIdentityContainer.querySelector("#birthdate"),t=this.identityPicker.createIdentityContainer.querySelector("#birthcountry"),i=this.identityPicker.createIdentityContainer.querySelector("#birthcountry_code"),n=this.identityPicker.createIdentityContainer.querySelector("#birthplace"),r=this.identityPicker.createIdentityContainer.querySelector("#birthplace_code");if(e&&t&&n){var o=""===e.value.trim(),a=!i||""===i.value.trim();t.disabled=o,this.birthcountryChoices&&(o?this.birthcountryChoices.disable():this.birthcountryChoices.enable());var s=!o&&!a;n.disabled=!s,s&&"99100"===i.value?this.setupBirthplaceSelect(n,e,r):this.setupBirthplaceInput(n,r),!s&&this.birthplaceChoices&&this.birthplaceChoices.disable()}}},{key:"setupBirthplaceSelect",value:function(e,t,i){var n=this,r=e.value,o=i?i.value:"";if("select"!==e.tagName.toLowerCase()){var a=document.createElement("select");if(a.id=e.id,a.name=e.name,a.className=e.className,e.required&&(a.required=!0),r&&o){var s=document.createElement("option");s.value=o,s.text=r,s.selected=!0,a.appendChild(s)}e.parentNode.replaceChild(a,e),e=a}this.birthplaceChoices?(this.birthplaceChoices.enable(),r&&o&&this.birthplaceChoices.setChoiceByValue(o)):(this.birthplaceChoices=new $t(e,{searchEnabled:!0,itemSelectText:"",placeholder:!0,placeholderValue:this.identityPicker.rules.language.selectCity,searchPlaceholderValue:this.identityPicker.rules.language.searchCity,shouldSort:!1,noResultsText:this.identityPicker.rules.language.noCityResults,noChoicesText:this.identityPicker.rules.language.noCityAvailable,loadingText:this.identityPicker.rules.language.loadingCities}),this.birthplaceChoices.passedElement.element.addEventListener("search",C((function(e){var i=e.detail.value;i&&i.length>=n.identityPicker.config.choices.minSearchLength&&n.fetchGeoCode("birthplace",i,t.value,n.birthplaceChoices)}),this.identityPicker.config.choices.debounceTime)),this.birthplaceChoices.passedElement.element.addEventListener("choice",(function(e){i&&(i.value=e.detail.value)})),r&&o&&this.birthplaceChoices.setChoiceByValue(o))}},{key:"setupBirthplaceInput",value:function(e,t){if(this.birthplaceChoices&&(this.birthplaceChoices.destroy(),this.birthplaceChoices=null),"input"!==e.tagName.toLowerCase()){var i=document.createElement("input");i.type="text",i.id=e.id,i.name=e.name,i.className=e.className,e.required&&(i.required=!0),e.parentNode.replaceChild(i,e)}t&&(t.value="")}},{key:"getAttributeInfo",value:function(e){var t=this.identityPicker.rules.referential.attributeKeyList.attributeKeys.find((function(t){return t.keyName===e}));return{label:t?t.name:e,description:t?t.description:""}}},{key:"getCertificationInfo",value:function(e,t){var i=this.identityPicker.rules.referential.processList.processus.find((function(e){return e.code===t}));if(i){var n=i.attributeCertificationLevels.find((function(t){return t.attributeKey===e}));if(n)return{label:i.label,description:n.level.description}}return{label:t,description:this.identityPicker.rules.language.certificationUnavailable}}},{key:"getDisplayValue",value:function(e,t){var i=this.identityPicker.rules.referential.attributeKeyList.attributeKeys.find((function(t){return t.keyName===e}));if(i&&i.values){var n=i.values.find((function(e){return e.value===t}));return n?n.label:t}return t}},{key:"handleSaveError",value:function(e){e.status&&e.status.attributes_status?this.displayFieldErrors(e.status.attributes_status):this.identityPicker.showInfoMessage(e.status.message||"An error occurred while saving","error")}},{key:"displayFieldErrors",value:function(e){var t=this;this.clearFieldErrors(),e.forEach((function(e){var i=t.identityPicker.createIdentityContainer.querySelector('[name="'.concat(e.key,'"]'));if(i){var n=document.createElement("div");n.className="ip-field-error",n.textContent=e.message,i.parentNode.insertBefore(n,i.nextSibling),i.classList.add("ip-error-input")}}))}},{key:"clearFieldErrors",value:function(){this.identityPicker.createIdentityContainer.querySelectorAll(".ip-field-error").forEach((function(e){return e.remove()})),this.identityPicker.createIdentityContainer.querySelectorAll(".ip-error-input").forEach((function(e){return e.classList.remove("ip-error-input")}))}}]);var e,t,n,o}();function Ut(e){return Array.isArray?Array.isArray(e):"[object Array]"===ti(e)}function Yt(e){return"string"==typeof e}function Jt(e){return"number"==typeof e}function Zt(e){return!0===e||!1===e||function(e){return Qt(e)&&null!==e}(e)&&"[object Boolean]"==ti(e)}function Qt(e){return"object"===b(e)}function Xt(e){return null!=e}function ei(e){return!e.trim().length}function ti(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}var ii=Object.prototype.hasOwnProperty,ni=function(){return a((function e(t){var i=this;r(this,e),this._keys=[],this._keyMap={};var n=0;t.forEach((function(e){var t=ri(e);i._keys.push(t),i._keyMap[t.id]=t,n+=t.weight})),this._keys.forEach((function(e){e.weight/=n}))}),[{key:"get",value:function(e){return this._keyMap[e]}},{key:"keys",value:function(){return this._keys}},{key:"toJSON",value:function(){return JSON.stringify(this._keys)}}])}();function ri(e){var t=null,i=null,n=null,r=1,o=null;if(Yt(e)||Ut(e))n=e,t=oi(e),i=ai(e);else{if(!ii.call(e,"name"))throw new Error(function(e){return"Missing ".concat(e," property in key")}("name"));var a=e.name;if(n=a,ii.call(e,"weight")&&(r=e.weight)<=0)throw new Error(function(e){return"Property 'weight' in key '".concat(e,"' must be a positive integer")}(a));t=oi(a),i=ai(a),o=e.getFn}return{path:t,id:i,weight:r,src:n,getFn:o}}function oi(e){return Ut(e)?e:e.split(".")}function ai(e){return Ut(e)?e.join("."):e}var si={useExtendedSearch:!1,getFn:function(e,t){var i=[],n=!1,r=function(e,t,o){if(Xt(e))if(t[o]){var a=e[t[o]];if(!Xt(a))return;if(o===t.length-1&&(Yt(a)||Jt(a)||Zt(a)))i.push(function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)}(a));else if(Ut(a)){n=!0;for(var s=0,c=a.length;s<c;s+=1)r(a[s],t,o+1)}else t.length&&r(a,t,o+1)}else i.push(e)};return r(e,Yt(t)?t.split("."):t,0),n?i:i[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},ci=p(p(p(p({},{isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:function(e,t){return e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1}}),{includeMatches:!1,findAllMatches:!1,minMatchCharLength:1}),{location:0,threshold:.6,distance:100}),si),li=/[^ ]+/g;var ui=function(){return a((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.getFn,n=void 0===i?ci.getFn:i,o=t.fieldNormWeight,a=void 0===o?ci.fieldNormWeight:o;r(this,e),this.norm=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=new Map,n=Math.pow(10,t);return{get:function(t){var r=t.match(li).length;if(i.has(r))return i.get(r);var o=1/Math.pow(r,.5*e),a=parseFloat(Math.round(o*n)/n);return i.set(r,a),a},clear:function(){i.clear()}}}(a,3),this.getFn=n,this.isCreated=!1,this.setIndexRecords()}),[{key:"setSources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.docs=e}},{key:"setIndexRecords",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.records=e}},{key:"setKeys",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.keys=t,this._keysMap={},t.forEach((function(t,i){e._keysMap[t.id]=i}))}},{key:"create",value:function(){var e=this;!this.isCreated&&this.docs.length&&(this.isCreated=!0,Yt(this.docs[0])?this.docs.forEach((function(t,i){e._addString(t,i)})):this.docs.forEach((function(t,i){e._addObject(t,i)})),this.norm.clear())}},{key:"add",value:function(e){var t=this.size();Yt(e)?this._addString(e,t):this._addObject(e,t)}},{key:"removeAt",value:function(e){this.records.splice(e,1);for(var t=e,i=this.size();t<i;t+=1)this.records[t].i-=1}},{key:"getValueForItemAtKeyId",value:function(e,t){return e[this._keysMap[t]]}},{key:"size",value:function(){return this.records.length}},{key:"_addString",value:function(e,t){if(Xt(e)&&!ei(e)){var i={v:e,i:t,n:this.norm.get(e)};this.records.push(i)}}},{key:"_addObject",value:function(e,t){var i=this,n={i:t,$:{}};this.keys.forEach((function(t,r){var o=t.getFn?t.getFn(e):i.getFn(e,t.path);if(Xt(o))if(Ut(o)){for(var a=[],s=[{nestedArrIndex:-1,value:o}];s.length;){var c=s.pop(),l=c.nestedArrIndex,u=c.value;if(Xt(u))if(Yt(u)&&!ei(u)){var h={v:u,i:l,n:i.norm.get(u)};a.push(h)}else Ut(u)&&u.forEach((function(e,t){s.push({nestedArrIndex:t,value:e})}))}n.$[r]=a}else if(Yt(o)&&!ei(o)){var d={v:o,n:i.norm.get(o)};n.$[r]=d}})),this.records.push(n)}},{key:"toJSON",value:function(){return{keys:this.keys,records:this.records}}}])}();function hi(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.getFn,r=void 0===n?ci.getFn:n,o=i.fieldNormWeight,a=void 0===o?ci.fieldNormWeight:o,s=new ui({getFn:r,fieldNormWeight:a});return s.setKeys(e.map(ri)),s.setSources(t),s.create(),s}function di(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.errors,n=void 0===i?0:i,r=t.currentLocation,o=void 0===r?0:r,a=t.expectedLocation,s=void 0===a?0:a,c=t.distance,l=void 0===c?ci.distance:c,u=t.ignoreLocation,h=void 0===u?ci.ignoreLocation:u,d=n/e.length;if(h)return d;var p=Math.abs(s-o);return l?d+p/l:p?1:d}var pi=32;function fi(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=n.location,o=void 0===r?ci.location:r,a=n.distance,s=void 0===a?ci.distance:a,c=n.threshold,l=void 0===c?ci.threshold:c,u=n.findAllMatches,h=void 0===u?ci.findAllMatches:u,d=n.minMatchCharLength,p=void 0===d?ci.minMatchCharLength:d,f=n.includeMatches,g=void 0===f?ci.includeMatches:f,m=n.ignoreLocation,v=void 0===m?ci.ignoreLocation:m;if(t.length>pi)throw new Error("Pattern length exceeds max of ".concat(pi,"."));for(var y,b=t.length,_=e.length,k=Math.max(0,Math.min(o,_)),x=l,w=k,C=p>1||g,E=C?Array(_):[];(y=e.indexOf(t,w))>-1;){var S=di(t,{currentLocation:y,expectedLocation:k,distance:s,ignoreLocation:v});if(x=Math.min(S,x),w=y+b,C)for(var L=0;L<b;)E[y+L]=1,L+=1}w=-1;for(var I=[],M=1,P=b+_,T=1<<b-1,A=0;A<b;A+=1){for(var O=0,N=P;O<N;){di(t,{errors:A,currentLocation:k+N,expectedLocation:k,distance:s,ignoreLocation:v})<=x?O=N:P=N,N=Math.floor((P-O)/2+O)}P=N;var F=Math.max(1,k-N+1),j=h?_:Math.min(k+N,_)+b,D=Array(j+2);D[j+1]=(1<<A)-1;for(var R=j;R>=F;R-=1){var q=R-1,B=i[e.charAt(q)];if(C&&(E[q]=+!!B),D[R]=(D[R+1]<<1|1)&B,A&&(D[R]|=(I[R+1]|I[R])<<1|1|I[R+1]),D[R]&T&&(M=di(t,{errors:A,currentLocation:q,expectedLocation:k,distance:s,ignoreLocation:v}))<=x){if(x=M,(w=q)<=k)break;F=Math.max(1,2*k-w)}}if(di(t,{errors:A+1,currentLocation:k,expectedLocation:k,distance:s,ignoreLocation:v})>x)break;I=D}var H={isMatch:w>=0,score:Math.max(.001,M)};if(C){var V=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ci.minMatchCharLength,i=[],n=-1,r=-1,o=0,a=e.length;o<a;o+=1){var s=e[o];s&&-1===n?n=o:s||-1===n||((r=o-1)-n+1>=t&&i.push([n,r]),n=-1)}return e[o-1]&&o-n>=t&&i.push([n,o-1]),i}(E,p);V.length?g&&(H.indices=V):H.isMatch=!1}return H}function gi(e){for(var t={},i=0,n=e.length;i<n;i+=1){var r=e.charAt(i);t[r]=(t[r]||0)|1<<n-i-1}return t}var mi=function(){return a((function e(t){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.location,a=void 0===o?ci.location:o,s=n.threshold,c=void 0===s?ci.threshold:s,l=n.distance,u=void 0===l?ci.distance:l,h=n.includeMatches,d=void 0===h?ci.includeMatches:h,p=n.findAllMatches,f=void 0===p?ci.findAllMatches:p,g=n.minMatchCharLength,m=void 0===g?ci.minMatchCharLength:g,v=n.isCaseSensitive,y=void 0===v?ci.isCaseSensitive:v,b=n.ignoreLocation,_=void 0===b?ci.ignoreLocation:b;if(r(this,e),this.options={location:a,threshold:c,distance:u,includeMatches:d,findAllMatches:f,minMatchCharLength:m,isCaseSensitive:y,ignoreLocation:_},this.pattern=y?t:t.toLowerCase(),this.chunks=[],this.pattern.length){var k=function(e,t){i.chunks.push({pattern:e,alphabet:gi(e),startIndex:t})},x=this.pattern.length;if(x>pi){for(var w=0,C=x%pi,E=x-C;w<E;)k(this.pattern.substr(w,pi),w),w+=pi;if(C){var S=x-pi;k(this.pattern.substr(S),S)}}else k(this.pattern,0)}}),[{key:"searchIn",value:function(e){var t=this.options,i=t.isCaseSensitive,n=t.includeMatches;if(i||(e=e.toLowerCase()),this.pattern===e){var r={isMatch:!0,score:0};return n&&(r.indices=[[0,e.length-1]]),r}var o=this.options,a=o.location,s=o.distance,c=o.threshold,l=o.findAllMatches,u=o.minMatchCharLength,h=o.ignoreLocation,d=[],p=0,f=!1;this.chunks.forEach((function(t){var i=t.pattern,r=t.alphabet,o=t.startIndex,g=fi(e,i,r,{location:a+o,distance:s,threshold:c,findAllMatches:l,minMatchCharLength:u,includeMatches:n,ignoreLocation:h}),m=g.isMatch,y=g.score,b=g.indices;m&&(f=!0),p+=y,m&&b&&(d=[].concat(v(d),v(b)))}));var g={isMatch:f,score:f?p/this.chunks.length:1};return f&&n&&(g.indices=d),g}}])}(),vi=function(){return a((function e(t){r(this,e),this.pattern=t}),[{key:"search",value:function(){}}],[{key:"isMultiMatch",value:function(e){return yi(e,this.multiRegex)}},{key:"isSingleMatch",value:function(e){return yi(e,this.singleRegex)}}])}();function yi(e,t){var i=e.match(t);return i?i[1]:null}var bi=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,vi),a(e,[{key:"search",value:function(e){var t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}],[{key:"type",get:function(){return"exact"}},{key:"multiRegex",get:function(){return/^="(.*)"$/}},{key:"singleRegex",get:function(){return/^=(.*)$/}}])}(),_i=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,vi),a(e,[{key:"search",value:function(e){var t=-1===e.indexOf(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-exact"}},{key:"multiRegex",get:function(){return/^!"(.*)"$/}},{key:"singleRegex",get:function(){return/^!(.*)$/}}])}(),ki=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,vi),a(e,[{key:"search",value:function(e){var t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}],[{key:"type",get:function(){return"prefix-exact"}},{key:"multiRegex",get:function(){return/^\^"(.*)"$/}},{key:"singleRegex",get:function(){return/^\^(.*)$/}}])}(),xi=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,vi),a(e,[{key:"search",value:function(e){var t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-prefix-exact"}},{key:"multiRegex",get:function(){return/^!\^"(.*)"$/}},{key:"singleRegex",get:function(){return/^!\^(.*)$/}}])}(),wi=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,vi),a(e,[{key:"search",value:function(e){var t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}],[{key:"type",get:function(){return"suffix-exact"}},{key:"multiRegex",get:function(){return/^"(.*)"\$$/}},{key:"singleRegex",get:function(){return/^(.*)\$$/}}])}(),Ci=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,vi),a(e,[{key:"search",value:function(e){var t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-suffix-exact"}},{key:"multiRegex",get:function(){return/^!"(.*)"\$$/}},{key:"singleRegex",get:function(){return/^!(.*)\$$/}}])}(),Ei=function(){function e(t){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.location,s=void 0===a?ci.location:a,c=o.threshold,l=void 0===c?ci.threshold:c,u=o.distance,h=void 0===u?ci.distance:u,d=o.includeMatches,p=void 0===d?ci.includeMatches:d,f=o.findAllMatches,g=void 0===f?ci.findAllMatches:f,m=o.minMatchCharLength,v=void 0===m?ci.minMatchCharLength:m,y=o.isCaseSensitive,b=void 0===y?ci.isCaseSensitive:y,_=o.ignoreLocation,k=void 0===_?ci.ignoreLocation:_;return r(this,e),(i=n(this,e,[t]))._bitapSearch=new mi(t,{location:s,threshold:l,distance:h,includeMatches:p,findAllMatches:g,minMatchCharLength:v,isCaseSensitive:b,ignoreLocation:k}),i}return u(e,vi),a(e,[{key:"search",value:function(e){return this._bitapSearch.searchIn(e)}}],[{key:"type",get:function(){return"fuzzy"}},{key:"multiRegex",get:function(){return/^"(.*)"$/}},{key:"singleRegex",get:function(){return/^(.*)$/}}])}(),Si=function(){function e(t){return r(this,e),n(this,e,[t])}return u(e,vi),a(e,[{key:"search",value:function(e){for(var t,i=0,n=[],r=this.pattern.length;(t=e.indexOf(this.pattern,i))>-1;)i=t+r,n.push([t,i-1]);var o=!!n.length;return{isMatch:o,score:o?0:1,indices:n}}}],[{key:"type",get:function(){return"include"}},{key:"multiRegex",get:function(){return/^'"(.*)"$/}},{key:"singleRegex",get:function(){return/^'(.*)$/}}])}(),Li=[bi,Si,ki,xi,Ci,wi,_i,Ei],Ii=Li.length,Mi=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/;var Pi=new Set([Ei.type,Si.type]),Ti=function(){return a((function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.isCaseSensitive,o=void 0===n?ci.isCaseSensitive:n,a=i.includeMatches,s=void 0===a?ci.includeMatches:a,c=i.minMatchCharLength,l=void 0===c?ci.minMatchCharLength:c,u=i.ignoreLocation,h=void 0===u?ci.ignoreLocation:u,d=i.findAllMatches,p=void 0===d?ci.findAllMatches:d,f=i.location,g=void 0===f?ci.location:f,m=i.threshold,v=void 0===m?ci.threshold:m,y=i.distance,b=void 0===y?ci.distance:y;r(this,e),this.query=null,this.options={isCaseSensitive:o,includeMatches:s,minMatchCharLength:l,findAllMatches:p,ignoreLocation:h,location:g,threshold:v,distance:b},this.pattern=o?t:t.toLowerCase(),this.query=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.split("|").map((function(e){for(var i=e.trim().split(Mi).filter((function(e){return e&&!!e.trim()})),n=[],r=0,o=i.length;r<o;r+=1){for(var a=i[r],s=!1,c=-1;!s&&++c<Ii;){var l=Li[c],u=l.isMultiMatch(a);u&&(n.push(new l(u,t)),s=!0)}if(!s)for(c=-1;++c<Ii;){var h=Li[c],d=h.isSingleMatch(a);if(d){n.push(new h(d,t));break}}}return n}))}(this.pattern,this.options)}),[{key:"searchIn",value:function(e){var t=this.query;if(!t)return{isMatch:!1,score:1};var i=this.options,n=i.includeMatches;e=i.isCaseSensitive?e:e.toLowerCase();for(var r=0,o=[],a=0,s=0,c=t.length;s<c;s+=1){var l=t[s];o.length=0,r=0;for(var u=0,h=l.length;u<h;u+=1){var d=l[u],p=d.search(e),f=p.isMatch,g=p.indices,m=p.score;if(!f){a=0,r=0,o.length=0;break}if(r+=1,a+=m,n){var y=d.constructor.type;Pi.has(y)?o=[].concat(v(o),v(g)):o.push(g)}}if(r){var b={isMatch:!0,score:a/r};return n&&(b.indices=o),b}}return{isMatch:!1,score:1}}}],[{key:"condition",value:function(e,t){return t.useExtendedSearch}}])}(),Ai=[];function Oi(e,t){for(var i=0,n=Ai.length;i<n;i+=1){var r=Ai[i];if(r.condition(e,t))return new r(e,t)}return new mi(e,t)}var Ni="$and",Fi="$or",ji="$path",Di="$val",Ri=function(e){return!(!e[Ni]&&!e[Fi])},qi=function(e){return c({},Ni,Object.keys(e).map((function(t){return c({},t,e[t])})))};function Bi(e,t){var i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).auto,n=void 0===i||i,r=function(e){var i=Object.keys(e),o=function(e){return!!e[ji]}(e);if(!o&&i.length>1&&!Ri(e))return r(qi(e));if(function(e){return!Ut(e)&&Qt(e)&&!Ri(e)}(e)){var a=o?e[ji]:i[0],s=o?e[Di]:e[a];if(!Yt(s))throw new Error(function(e){return"Invalid value for key ".concat(e)}(a));var c={keyId:ai(a),pattern:s};return n&&(c.searcher=Oi(s,t)),c}var l={children:[],operator:i[0]};return i.forEach((function(t){var i=e[t];Ut(i)&&i.forEach((function(e){l.children.push(r(e))}))})),l};return Ri(e)||(e=qi(e)),r(e)}function Hi(e,t){var i=e.matches;t.matches=[],Xt(i)&&i.forEach((function(e){if(Xt(e.indices)&&e.indices.length){var i={indices:e.indices,value:e.value};e.key&&(i.key=e.key.src),e.idx>-1&&(i.refIndex=e.idx),t.matches.push(i)}}))}function Vi(e,t){t.score=e.score}var zi=function(){return a((function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;r(this,e),this.options=p(p({},ci),i),this.options.useExtendedSearch,this._keyStore=new ni(this.options.keys),this.setCollection(t,n)}),[{key:"setCollection",value:function(e,t){if(this._docs=e,t&&!(t instanceof ui))throw new Error("Incorrect 'index' type");this._myIndex=t||hi(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}},{key:"add",value:function(e){Xt(e)&&(this._docs.push(e),this._myIndex.add(e))}},{key:"remove",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return!1},t=[],i=0,n=this._docs.length;i<n;i+=1){var r=this._docs[i];e(r,i)&&(this.removeAt(i),i-=1,n-=1,t.push(r))}return t}},{key:"removeAt",value:function(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}},{key:"getIndex",value:function(){return this._myIndex}},{key:"search",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).limit,i=void 0===t?-1:t,n=this.options,r=n.includeMatches,o=n.includeScore,a=n.shouldSort,s=n.sortFn,c=n.ignoreFieldNorm,l=Yt(e)?Yt(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(e,t){var i=t.ignoreFieldNorm,n=void 0===i?ci.ignoreFieldNorm:i;e.forEach((function(e){var t=1;e.matches.forEach((function(e){var i=e.key,r=e.norm,o=e.score,a=i?i.weight:null;t*=Math.pow(0===o&&a?Number.EPSILON:o,(a||1)*(n?1:r))})),e.score=t}))}(l,{ignoreFieldNorm:c}),a&&l.sort(s),Jt(i)&&i>-1&&(l=l.slice(0,i)),function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.includeMatches,r=void 0===n?ci.includeMatches:n,o=i.includeScore,a=void 0===o?ci.includeScore:o,s=[];return r&&s.push(Hi),a&&s.push(Vi),e.map((function(e){var i=e.idx,n={item:t[i],refIndex:i};return s.length&&s.forEach((function(t){t(e,n)})),n}))}(l,this._docs,{includeMatches:r,includeScore:o})}},{key:"_searchStringList",value:function(e){var t=Oi(e,this.options),i=this._myIndex.records,n=[];return i.forEach((function(e){var i=e.v,r=e.i,o=e.n;if(Xt(i)){var a=t.searchIn(i),s=a.isMatch,c=a.score,l=a.indices;s&&n.push({item:i,idx:r,matches:[{score:c,value:i,norm:o,indices:l}]})}})),n}},{key:"_searchLogical",value:function(e){var t=this,i=Bi(e,this.options),n=function(e,i,r){if(!e.children){var o=e.keyId,a=e.searcher,s=t._findMatches({key:t._keyStore.get(o),value:t._myIndex.getValueForItemAtKeyId(i,o),searcher:a});return s&&s.length?[{idx:r,item:i,matches:s}]:[]}for(var c=[],l=0,u=e.children.length;l<u;l+=1){var h=e.children[l],d=n(h,i,r);if(d.length)c.push.apply(c,v(d));else if(e.operator===Ni)return[]}return c},r=this._myIndex.records,o={},a=[];return r.forEach((function(e){var t=e.$,r=e.i;if(Xt(t)){var s=n(i,t,r);s.length&&(o[r]||(o[r]={idx:r,item:t,matches:[]},a.push(o[r])),s.forEach((function(e){var t,i=e.matches;(t=o[r].matches).push.apply(t,v(i))})))}})),a}},{key:"_searchObjectList",value:function(e){var t=this,i=Oi(e,this.options),n=this._myIndex,r=n.keys,o=n.records,a=[];return o.forEach((function(e){var n=e.$,o=e.i;if(Xt(n)){var s=[];r.forEach((function(e,r){s.push.apply(s,v(t._findMatches({key:e,value:n[r],searcher:i})))})),s.length&&a.push({idx:o,item:n,matches:s})}})),a}},{key:"_findMatches",value:function(e){var t=e.key,i=e.value,n=e.searcher;if(!Xt(i))return[];var r=[];if(Ut(i))i.forEach((function(e){var i=e.v,o=e.i,a=e.n;if(Xt(i)){var s=n.searchIn(i),c=s.isMatch,l=s.score,u=s.indices;c&&r.push({score:l,key:t,value:i,idx:o,norm:a,indices:u})}}));else{var o=i.v,a=i.n,s=n.searchIn(o),c=s.isMatch,l=s.score,u=s.indices;c&&r.push({score:l,key:t,value:o,norm:a,indices:u})}return r}}])}();zi.version="7.0.0",zi.createIndex=hi,zi.parseIndex=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.getFn,n=void 0===i?ci.getFn:i,r=t.fieldNormWeight,o=void 0===r?ci.fieldNormWeight:r,a=e.keys,s=e.records,c=new ui({getFn:n,fieldNormWeight:o});return c.setKeys(a),c.setIndexRecords(s),c},zi.config=ci,zi.parseQuery=Bi,function(){Ai.push.apply(Ai,arguments)}(Ti);var Ki=function(){return a((function e(t){r(this,e),this.identityPicker=t,this.globalHistory=[],this.fuse=null}),[{key:"loadGlobalHistory",value:(n=i(f().mark((function e(t){var i,n,r,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.identityPicker.showLoading(this.identityPicker.rules.language.loadingHistory),e.prev=1,e.next=4,Promise.all([this.fetchIdentityHistory(t),this.fetchIdentityTasks(t)]);case 4:i=e.sent,n=m(i,2),r=n[0],o=n[1],this.globalHistory=this.mergeHistoryData(r,o),this.initFuseSearch(),this.displayGlobalHistory(this.globalHistory),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),console.error(this.identityPicker.rules.language.fetchError,e.t0),this.identityPicker.showInfoMessage("errorLoadingHistory","error");case 17:return e.prev=17,this.identityPicker.hideLoading(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[1,13,17,20]])}))),function(e){return n.apply(this,arguments)})},{key:"fetchIdentityHistory",value:(t=i(f().mark((function e(t){var i,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(this.identityPicker.config.endpoints.identity,"/").concat(t,"/").concat(this.identityPicker.config.endpoints.history),e.next=3,fetch(i);case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("".concat(this.identityPicker.rules.language.httpError," ").concat(n.status));case 6:return e.abrupt("return",n.json());case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"fetchIdentityTasks",value:(e=i(f().mark((function e(t){var i,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(this.identityPicker.config.endpoints.identity,"/").concat(t,"/").concat(this.identityPicker.config.endpoints.tasks),e.next=3,fetch(i);case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("".concat(this.identityPicker.rules.language.httpError," ").concat(n.status));case 6:return e.abrupt("return",n.json());case 7:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})},{key:"mergeHistoryData",value:function(e,t){var i=this,n=[],r=this.identityPicker.rules.language;return e.identity_changes.forEach((function(e){var t,o,a=(null===(t=r.history[e.changeType.toLowerCase()])||void 0===t?void 0:t[e.changeStatus.toLowerCase()])||"",s=(null===(o=e.author)||void 0===o?void 0:o.author_name)||r.unknown,c=e.changeMessage||"",l=i.formatDate(parseInt(e.modificationDate));n.push({date:new Date(parseInt(e.modificationDate)),type:"identity",data:e,changeTypeText:a,authorName:s,changeMessage:c,searchableText:"".concat(l," ").concat(a," ").concat(s," ").concat(c)})})),e.attribute_histories.forEach((function(e){var t,o,a,s=(t=e.attribute_key,o=i.identityPicker.rules.referential,{label:(a=o.attributeKeyList.attributeKeys.find((function(e){return e.keyName===t})))?a.name:t,description:a?a.description:""}),c=(null==s?void 0:s.label)||"";e.attribute_changes.forEach((function(t){var o=t.attribute_value||"",a=r.attributeChangeType||"",s=i.formatDate(parseInt(t.modification_date));n.push({date:new Date(parseInt(t.modification_date)),type:"attribute",data:p(p({},t),{},{attribute_key:e.attribute_key}),attributeLabel:c,attributeValue:o,attributeChangeType:a,searchableText:"".concat(s," ").concat(c," ").concat(o," ").concat(a)})}))})),t.forEach((function(e){e.task_history.forEach((function(t){var o,a=r.tasks,s=i.getTaskTypeText(e.task_type,a),c=i.getTaskChangeTypeText(e.task_type,t.task_change_type,t.task_status,a),l=i.getTaskStatusText(e.task_type,t.task_status,a),u=(null===(o=t.request_author)||void 0===o?void 0:o.author_name)||r.unknown,h=Object.values(e.metadata||{}).join(" "),d=i.formatDate(parseInt(t.task_change_date));n.push({date:new Date(parseInt(t.task_change_date)),type:"task",data:{task:e,change:t},taskTypeText:s,changeTypeText:c,statusText:l,authorName:u,metadataText:h,taskCode:e.task_code,searchableText:"".concat(d," ").concat(s," ").concat(c," ").concat(l," ").concat(u," ").concat(h)})}))})),n.sort((function(e,t){return t.date-e.date})),n}},{key:"getTaskTypeText",value:function(e,t){var i;return(null===(i=t[e.toLowerCase()])||void 0===i?void 0:i.label)||e}},{key:"getTaskChangeTypeText",value:function(e,t,i,n){var r,o=e.toLowerCase(),a=t.toLowerCase(),s=i.toLowerCase();return(null===(r=n[o])||void 0===r||null===(r=r[a])||void 0===r?void 0:r[s])||"".concat(e," ").concat(t," ").concat(i)}},{key:"getTaskStatusText",value:function(e,t,i){var n,r=e.toLowerCase(),o=t.toLowerCase();return(null===(n=i[r])||void 0===n||null===(n=n.status)||void 0===n?void 0:n[o])||t}},{key:"initFuseSearch",value:function(){this.fuse=new zi(this.globalHistory,{includeScore:!0,threshold:.3,useExtendedSearch:!0,keys:["type","changeTypeText","authorName","changeMessage","attributeLabel","attributeValue","taskTypeText","statusText","metadataText","taskCode","searchableText"]})}},{key:"searchHistory",value:function(e){if(!e)return this.globalHistory;var t={$and:e.split(" ").filter(Boolean).map((function(e){return{$or:[{type:e},{changeTypeText:e},{authorName:e},{changeMessage:e},{attributeLabel:e},{attributeValue:e},{taskTypeText:e},{taskCode:e},{statusText:e},{metadataText:e},{searchableText:e}]}}))};return this.fuse.search(t).map((function(e){return e.item})).sort((function(e,t){return t.date-e.date}))}},{key:"displayGlobalHistory",value:function(e){var t=this.generateGlobalHistoryHTML(e),i=this.generateSearchBarHTML();this.identityPicker.openSideContainer(this.identityPicker.rules.language.historyTitle,i+'<div class="ip-timeline">'.concat(t,"</div>")),this.attachListener()}},{key:"generateSearchBarHTML",value:function(){return'\n            <div class="ip-search-bar">\n                <input type="text" class="ip-search-input" placeholder="'.concat(this.identityPicker.rules.language.searchHistory,'">\n            </div>\n        ')}},{key:"attachListener",value:function(){var e=this,t=this.identityPicker.sideContainer.querySelector(".ip-search-input");t.addEventListener("input",(function(t){var i=t.target.value,n=e.searchHistory(i),r=e.generateGlobalHistoryHTML(n);document.querySelector(".ip-timeline").innerHTML=r})),t.focus(),this.identityPicker.sideContainer.querySelectorAll(".ip-copy-button").forEach((function(t){t.addEventListener("click",(function(t){var i=t.target.dataset.taskCode;e.copyToClipboard(i,t.target)}))}))}},{key:"generateGlobalHistoryHTML",value:function(e){var t=this,i="",n=null,r=[];return e.forEach((function(e){if("task"===e.type)i+=t.renderSingleEvent(e);else{var o=t.formatDateForGrouping(e.date);o!==n&&(n&&(i+=t.renderDateEvents(n,r)),n=o,r=[]),r.push(e)}})),n&&(i+=this.renderDateEvents(n,r)),i}},{key:"renderSingleEvent",value:function(e){return'\n            <div class="ip-timeline-item">\n                <div class="ip-timeline-point"></div>\n                <div class="ip-timeline-content">\n                    <div class="ip-date-and-types">\n                        <span class="date">'.concat(this.formatDate(e.date),'</span>\n                        <span class="ip-event-types">\n                            <span class="ip-mini-tag ip-tag-').concat(e.type,'">').concat(this.getEventTypeLabel(e.type),"</span>\n                        </span>\n                    </div>\n                    ").concat(this.generateTaskChangeHTML(e),"\n\n                </div>\n            </div>\n        ")}},{key:"renderDateEvents",value:function(e,t){var i=this,n=this.getEventTypes(t),r=this.groupEventsByType(t),o=n.includes("attribute")?["attribute"]:n;return'\n            <div class="ip-timeline-item">\n                <div class="ip-timeline-point"></div>\n                <div class="ip-timeline-content">\n                    <div class="ip-date-and-types">\n                        <span class="date">'.concat(e,'</span>\n                        <span class="ip-event-types">\n                            ').concat(o.map((function(e){return'<span class="ip-mini-tag ip-tag-'.concat(e,'">').concat(i.getEventTypeLabel(e),"</span>")})).join(""),"\n                        </span>\n                    </div>\n                    ").concat(this.renderGroupedEvents(r),"\n                </div>\n            </div>\n        ")}},{key:"groupEventsByType",value:function(e){var t={identity:[],attribute:[],task:[]};return e.forEach((function(e){t[e.type].push(e)})),t}},{key:"renderGroupedEvents",value:function(e){var t=this,i="";return e.identity.length>0&&(i+=this.generateIdentityChangeHeader(e.identity[0])),e.attribute.length>0&&(i+=this.generateAttributeChangesTable(e.attribute)),e.task.forEach((function(e){i+=t.generateTaskChangeHTML(e)})),i}},{key:"getEventTypes",value:function(e){return v(new Set(e.map((function(e){return e.type}))))}},{key:"getEventTypeLabel",value:function(e){return{identity:this.identityPicker.rules.language.identityChangeType,attribute:this.identityPicker.rules.language.attributeChangeType,task:this.identityPicker.rules.language.taskChangeType}[e]||e}},{key:"generateIdentityChangeHeader",value:function(e){return e?'\n            <div class="ip-identity-change-header">\n                <h3 class="change-type">'.concat(e.changeTypeText,'</h3>\n                <span title="').concat(this.identityPicker.rules.language.author,'">').concat(e.authorName,"</span>\n                ").concat(e.changeMessage?'<br><small class="ip-change-message">'.concat(e.changeMessage,"</small>"):"","\n            </div>\n        "):""}},{key:"generateAttributeChangesTable",value:function(e){if(0===e.length)return"";var t='\n            <table class="ip-table">\n                <tbody>\n        ';return e.forEach((function(e){t+="\n                <tr>\n                    <td>".concat(e.attributeLabel,"</td>\n                    <td>").concat(e.attributeValue,"</td>\n                </tr>\n            ")})),t+="</tbody></table>"}},{key:"generateTaskChangeHTML",value:function(e){return'\n           <div class="ip-task-change">\n            <h3 class="change-type">'.concat(e.changeTypeText,'</h3>\n            <span title="').concat(this.identityPicker.rules.language.author,'">').concat(e.authorName,'</span><br>\n            <button class="ip-copy-button" data-task-code="').concat(e.taskCode,'">\n                ').concat(e.taskCode?"".concat(e.taskCode.substring(0,15),"..."):"Copy","\n            </button>\n            <small>").concat(this.generateTaskMetadata(e.data.task.metadata),"</small>\n            </div>\n        ")}},{key:"generateTaskMetadata",value:function(e){if(!e||0===Object.keys(e).length)return"";for(var t='<div class="ip-task-metadata">',i=0,n=Object.entries(e);i<n.length;i++){var r=m(n[i],2),o=r[0],a=r[1];t+="<div><strong>".concat(o,":</strong> ").concat(a,"</div>")}return t+="</div>"}},{key:"formatDate",value:function(e){return new Date(e).toLocaleString(this.identityPicker.config.locale,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}},{key:"formatDateForGrouping",value:function(e){return e.toLocaleString(this.identityPicker.config.locale,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}},{key:"copyToClipboard",value:function(e,t){var i=this;navigator.clipboard.writeText(e).then((function(){var e=t.textContent;t.textContent=i.identityPicker.rules.language.copied||"Copied!",setTimeout((function(){t.textContent=e}),2e3)})).catch((function(e){console.error("Failed to copy: ",e)}))}}]);var e,t,n}(),Gi=function(){return a((function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e),this.uniqueId=t,this.config=p(p({},x),i),this.attributeGroups=w,this.permissions={search:!1,creation:!1,update:!1,view:!1,create_task:!1},this.openButton=document.getElementById("ip-open-button-".concat(t)),this.rules=null,this.init()}),[{key:"init",value:(o=i(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.openButton.disabled=!0,e.prev=1,e.next=4,this.fetchAndApplyPermissions();case 4:e.next=12;break;case 6:return e.prev=6,e.t0=e.catch(1),console.error("Failed to fetch permissions:",e.t0),this.openButton.textContent="Permissions "+e.t0,this.openButton.disabled=!0,e.abrupt("return");case 12:if(!Object.values(this.permissions).some(Boolean)){e.next=36;break}return e.prev=13,e.next=16,this.fetchRules();case 16:e.next=24;break;case 18:return e.prev=18,e.t1=e.catch(13),console.error("Failed to fetch rules:",e.t1),this.openButton.textContent="Referential "+e.t1,this.openButton.disabled=!0,e.abrupt("return");case 24:return this.identitySearch=new L(this),this.identityView=new I(this),this.identityForm=new Wt(this),this.identityHistory=new Ki(this),e.next=30,this.createModal();case 30:this.config.autoFill&&null!=this.config.cuid&&""!==this.config.cuid&&setTimeout((function(){return t.identityView.autoFillIdentity(t.config.cuid)}),0),this.openButton.addEventListener("click",(function(e){e.preventDefault(),t.openModal()})),this.initSideContainer(),this.openButton.disabled=!1,e.next=38;break;case 36:this.openButton.textContent="user permission empty",this.openButton.disabled=!0;case 38:case"end":return e.stop()}}),e,this,[[1,6],[13,18]])}))),function(){return o.apply(this,arguments)})},{key:"fetchAndApplyPermissions",value:(n=i(f().mark((function e(){var t,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.config.endpoints.permissions);case 3:if((t=e.sent).ok){e.next=6;break}throw new Error("HTTP error ".concat(t.status));case 6:return e.next=8,t.json();case 8:i=e.sent,this.permissions={search:this.config.search&&i.SEARCH,creation:this.config.creation&&i.CREATE,update:this.config.update&&i.UPDATE,view:i.VIEW,create_task:this.config.create_task&&i.CREATE_TASK},e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(0),console.error("Failed to fetch permissions:",e.t0),e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return n.apply(this,arguments)})},{key:"fetchRules",value:(t=i(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.config.endpoints.rules);case 3:if((t=e.sent).ok){e.next=6;break}throw new Error("HTTP error ".concat(t.status));case 6:return e.next=8,t.json();case 8:this.rules=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(0),console.error("Failed to fetch rules:",e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(){return t.apply(this,arguments)})},{key:"createModal",value:(e=i(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.modal=document.createElement("div"),this.modal.className="ip-modal",null!=this.config.cuid&&""!==this.config.cuid&&this.modal.setAttribute("data-cuid",this.config.cuid),this.modal.innerHTML=this.getModalHTML(),document.body.appendChild(this.modal),this.modalContent=this.modal.querySelector(".ip-modal-content"),this.searchContainer=this.modal.querySelector(".ip-search-container"),this.resultsContainer=this.modal.querySelector(".ip-results-container"),this.detailsContainer=this.modal.querySelector(".ip-details-container"),this.historyContainer=this.modal.querySelector(".ip-history-container"),this.createIdentityContainer=this.modal.querySelector(".ip-create-identity-container"),this.backButton=this.modal.querySelector(".ip-back"),this.infoMessage=this.modal.querySelector(".ip-info-message"),this.contentArea=this.modal.querySelector(".ip-content-area"),this.headerTitle=this.modal.querySelector(".ip-header h2"),this.modalHeader=this.modal.querySelector(".ip-header"),this.modalFooter=this.modal.querySelector(".ip-footer"),this.modalScrollableContent=this.modal.querySelectorAll(".ip-scrollable-content"),e.next=20,this.identitySearch.initSearchView();case 20:this.modal.querySelector(".ip-close").addEventListener("click",(function(){return t.closeModal()})),this.modal.addEventListener("click",(function(e){e.target===t.modal&&t.closeModal()})),this.backButton.addEventListener("click",(function(){return t.showSearchView()}));case 23:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"getModalHTML",value:function(){return'\n      <div class="ip-modal-content">\n        <div class="ip-header">\n          <div class="ip-header-container">\n            <span class="ip-back" style="display: none;">&#8592;</span>\n            <h2></h2>\n            <button class="ip-close ip-button-light ip-button-rounded">&times;</button>\n          </div>\n        </div>\n        <div class="ip-main-container">\n          <div class="ip-scrollable-content">\n            <div class="ip-content-area">\n              <div class="ip-info-message" style="display: none;"></div>\n              <div class="ip-search-container" style="display: none;"></div>\n              <div class="ip-results-container" style="display: none;"></div>\n              <div class="ip-details-container" style="display: none;"></div>\n              <div class="ip-create-identity-container" style="display: none;"></div>\n              <div class="ip-loading-container" style="display: none;">\n                <div class="ip-loader"></div>\n                <div class="ip-loading-message"></div>\n              </div>\n            </div>\n          </div>\n          <div class="ip-side-container" style="display: none;">\n            <div class="ip-header">\n              <div class="ip-header-container">\n                <h2></h2>\n                <button class="ip-side-close ip-button-light ip-button-rounded">√ó</button>\n              </div>\n            </div>\n            <div class="ip-scrollable-content">\n              <div class="ip-content-area"></div>\n            </div>\n          </div>\n        </div>\n        <div class="ip-footer" style="display:none"></div>\n      </div>\n    '}},{key:"initSideContainer",value:function(){var e=this;this.sideContainer=this.modal.querySelector(".ip-side-container"),this.sideContent=this.sideContainer.querySelector(".ip-content-area"),this.sideCloseButton=this.sideContainer.querySelector(".ip-side-close"),this.sideCloseButton.addEventListener("click",(function(){return e.closeSideContainer()}))}},{key:"openSideContainer",value:function(e,t){this.sideContainer.querySelector("h2").textContent=e,this.sideContent.innerHTML=t,this.sideContainer.style.display="block",this.modalContent.classList.add("with-side-container"),this.adjustModalLayout()}},{key:"closeSideContainer",value:function(){this.sideContainer.style.display="none",this.modalContent.classList.remove("with-side-container"),this.adjustModalLayout()}},{key:"adjustModalLayout",value:function(){window.innerWidth>=1280?(this.modalContent.classList.add("side-by-side"),this.sideContainer.classList.remove("overlay")):(this.modalContent.classList.remove("side-by-side"),this.sideContainer.classList.add("overlay")),this.adjustModalHeight()}},{key:"showInfoMessage",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=this.rules.language[e]||e;this.infoMessage.innerHTML='\n        <p class="ip-info-message-main">'.concat(r,"</p>\n        ").concat(n?'<p class="ip-info-message-description">'.concat(n,"</p>"):"",'\n        <span class="ip-info-message-close">&times;</span>\n    '),this.infoMessage.className="ip-info-message ".concat(t),this.infoMessage.style.display="block",this.infoMessage.querySelector(".ip-info-message-close").addEventListener("click",(function(){return i.hideInfoMessage()})),this.adjustModalHeight()}},{key:"showSearchView",value:function(){this.closeSideContainer(),this.transitionView(this.searchContainer),this.backButton.style.display="none",this.modalContent.classList.remove("wide-view"),this.setHeaderTitle(this.rules.language.searchTitle)}},{key:"showResultsView",value:function(){var e=this;this.closeSideContainer(),this.resultsContainer.querySelector(".ip-results-list")&&0===this.resultsContainer.querySelector(".ip-results-list").children.length?this.showSearchView():(this.transitionView(this.resultsContainer),this.backButton.style.display="inline",this.backButton.onclick=function(){return e.showSearchView()},this.modalContent.classList.remove("wide-view"),this.setHeaderTitle(this.rules.language.resultsTitle))}},{key:"showDetailsView",value:function(){var e=this;this.closeSideContainer(),this.transitionView(this.detailsContainer),this.backButton.style.display="inline",this.backButton.onclick=function(){return e.showResultsView()},this.modalContent.classList.add("wide-view"),this.setHeaderTitle(this.rules.language.detailsTitle)}},{key:"showCreateIdentityView",value:function(e){var t=this;this.hideInfoMessage(),this.closeSideContainer(),this.transitionView(this.createIdentityContainer),this.backButton.style.display="inline",this.backButton.onclick=function(){return t.showResultsView()},this.modalContent.classList.add("wide-view");var i="create"===e?this.rules.language.createTitle:this.rules.language.modifyTitle;this.setHeaderTitle(i)}},{key:"setHeaderTitle",value:function(e){this.headerTitle.textContent=e}},{key:"transitionView",value:function(e){[this.searchContainer,this.resultsContainer,this.detailsContainer,this.createIdentityContainer].forEach((function(e){e.style.display="none",e.classList.remove("active")})),e.style.display="block",e.classList.add("active"),this.adjustModalHeight()}},{key:"adjustModalHeight",value:function(){var e=this;this.modalContent.style.maxHeight="".concat(.9*window.innerHeight,"px"),this.modalScrollableContent.forEach((function(t){t.style.maxHeight="".concat(.9*window.innerHeight-e.modalHeader.offsetHeight-e.modalFooter.offsetHeight,"px")}))}},{key:"showLoading",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rules.language.loading;this.closeSideContainer(),this.scrollToTop();var t=this.modal.querySelector(".ip-loading-container");(t.querySelector(".ip-loading-message")||this.createLoadingMessage()).textContent=e,t.style.display="flex",t.offsetWidth,t.classList.add("show")}},{key:"hideInfoMessage",value:function(){this.infoMessage.style.display="none",this.infoMessage.innerHTML="",this.adjustModalHeight()}},{key:"createLoadingMessage",value:function(){this.hideInfoMessage();var e=document.createElement("div");return e.className="ip-loading-message",this.modal.querySelector(".ip-loading-container").appendChild(e),e}},{key:"hideLoading",value:function(){this.scrollToTop();var e=this.modal.querySelector(".ip-loading-container");e.classList.remove("show"),setTimeout((function(){e.style.display="none"}),300)}},{key:"scrollToTop",value:function(){this.modalScrollableContent.forEach((function(e){e.scrollTop=0}))}},{key:"openModal",value:function(){var e=this;this.modal.style.display="flex";var t=this.permissions.search,i=this.permissions.view,n=this.modal.getAttribute("data-cuid");t||i?i&&n?this.identityView.loadIdentityDetails(n):!i||n||t?this.showSearchView():this.showInfoMessage("noCuid","error"):this.showInfoMessage("noPermissions","error"),document.body.classList.add("ip-body"),requestAnimationFrame((function(){e.modal.classList.add("ip-modal-open"),e.adjustModalHeight()}))}},{key:"closeModal",value:function(){var e=this;this.modal.classList.remove("ip-modal-open"),this.modal.classList.add("ip-modal-closing"),setTimeout((function(){document.body.classList.remove("ip-body"),e.modal.style.display="none",e.modal.classList.remove("ip-modal-closing")}),300)}}]);var e,t,n,o}();export{Gi as default};
